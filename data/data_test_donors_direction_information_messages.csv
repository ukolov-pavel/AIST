query, test_data_set_number
"select top(1) PerC.UniqueId Ent, 'Донор является потенциально почетным по количеству сданных донаций' OR1, 0 NumStr, Bl.Q - 2 Al, Bl.Q - 1 Bl, '0' Pl from ref.SystemSettings SysSet, HonorableDonors HonD, PersonCards PerC join AppointedDonationTypes AppD on PerC.UniqueId = AppD.DonorId join (select AppD.DonorId, max(AppD.DonationDate) MaxDate from AppointedDonationTypes AppD group by AppD.DonorId) Main on AppD.DonorId = Main.DonorId and AppD.DonationDate = Main.MaxDate join ref.DonationTypeParams DonTP on AppD.DonationTypeId = DonTP.DonationTypeId join ref.DonationTypes DonT on AppD.DonationTypeId = DonT.UniqueId join (select Don.DonorId, count(Don.UniqueId) Q from Donations Don join ref.DonationTypes DonT on Don.DonationTypeId = DonT.UniqueId where DonT.ComponentType = 1 and Don.IsDeleted = 0 and Don.UniqueId not in (select DonCom.DonationId from DonationComplications DonCom join ref.DonationComplicationTypes DonComT on DonCom.ComplicationTypeGuid = DonComT.Guid where DonComT.CalculateDonation = 0) and cast(Don.DonationDate as date) > dateadd(year, -1, cast(getdate() as date)) group by Don.DonorId) Com on PerC.UniqueId = Com.DonorId join (select Don.DonorId, count(Don.UniqueId) Q from Donations Don join ref.DonationTypes DonT on Don.DonationTypeId = DonT.UniqueId where DonT.ComponentType in (1, 3, 4, 5) and Don.IsDeleted = 0 and Don.UniqueId not in (select DonCom.DonationId from DonationComplications DonCom join ref.DonationComplicationTypes DonComT on DonCom.ComplicationTypeGuid = DonComT.Guid where DonComT.CalculateDonation = 0) and DonT.ChargeType = 1 group by Don.DonorId) Bl on PerC.UniqueId = Bl.DonorId left join (select Don.DonorId, count(Don.UniqueId) Q from Donations Don join ref.DonationTypes DonT on Don.DonationTypeId = DonT.UniqueId where DonT.ComponentType = 2 and Don.IsDeleted = 0 and Don.UniqueId not in (select DonCom.DonationId from DonationComplications DonCom join ref.DonationComplicationTypes DonComT on DonCom.ComplicationTypeGuid = DonComT.Guid where DonComT.CalculateDonation = 0) and DonT.ChargeType = 1 group by Don.DonorId) Pl on PerC.UniqueId = Pl.DonorId where PerC.IsDeleted != 1 and Com.Q < SysSet.MaxYearBloodDonationCountFemale and Com.Q < SysSet.MaxYearBloodDonationCountMale and PerC.BirthDateIsUndefined = 0 and PerC.DeathDate is null and PerC.UniqueId not in (select PrReg.DonorId from DonationProcessRegistry PrReg where PrReg.RegDate = cast(getdate() as date)) and PerC.UniqueId not in (select Don.DonorId from Donations Don where cast(Don.DonationDate as date) = cast(getdate() as date)) and PerC.UniqueId not in (select Def.DonorId from Deferrals Def join ref.DeferralTypes DefT on Def.DeferralTypeId = DefT.UniqueId where ((DefT.BaseType in (1, 2) and Def.RevokeDate is null) or (DefT.BaseType = 3 and cast(Def.StopDate as date) >= cast(getdate() as date)))) and PerC.UniqueId not in (select MaxDon.DonorId from Donations Don join (select Don.DonorId, max(Don.DonationDate) MaxDate from Donations Don, ref.SystemSettings SysSet where Don.OrgId = SysSet.CurrentOrganizationId group by Don.DonorId) MaxDon on Don.DonorId = MaxDon.DonorId and Don.DonationDate = MaxDon.MaxDate join DonationTestResults DonTest on Don.UniqueId = DonTest.DonationId where DonTest.TestTypeId = 42 and DonTest.TestValue = 13) and PerC.Gender in (1,2) and PerC.IdentityDocId is not null and ((PerC.RegAddressId is not null and PerC.RegAddressIsInactive = 0) or (PerC.FactAddressId is not null and PerC.FactAddressIsInactive = 0) or (PerC.TempAddressId is not null and PerC.TempAddressIsInactive = 0)) and DonTP.IsActive = 1 and DonT.DonationParams not in (4, 5, 6, 7, 12, 15) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType = 2) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType in (3, 4) and MedTT.BloodTestCategory != 10) and DonT.ComponentType = 1 and DonT.ChargeType not in (0, 3) and PerC.UniqueId != HonD.DonorId and Bl.Q between 4 and 999 and Pl.Q is null",1
"select top(1) PerC.UniqueId Ent, 'Донор является потенциально почетным по количеству сданных донаций' OR1, 1 NumStr, Pl.Q Al, '0' Bl, Pl.Q Pl from ref.SystemSettings SysSet, HonorableDonors HonD, PersonCards PerC join AppointedDonationTypes AppD on PerC.UniqueId = AppD.DonorId join (select AppD.DonorId, max(AppD.DonationDate) MaxDate from AppointedDonationTypes AppD group by AppD.DonorId) Main on AppD.DonorId = Main.DonorId and AppD.DonationDate = Main.MaxDate join ref.DonationTypeParams DonTP on AppD.DonationTypeId = DonTP.DonationTypeId join ref.DonationTypes DonT on AppD.DonationTypeId = DonT.UniqueId join (select Don.DonorId, count(Don.UniqueId) Q from Donations Don join ref.DonationTypes DonT on Don.DonationTypeId = DonT.UniqueId where DonT.ComponentType = 1 and Don.IsDeleted = 0 and Don.UniqueId not in (select DonCom.DonationId from DonationComplications DonCom join ref.DonationComplicationTypes DonComT on DonCom.ComplicationTypeGuid = DonComT.Guid where DonComT.CalculateDonation = 0) and cast(Don.DonationDate as date) > dateadd(year, -1, cast(getdate() as date)) group by Don.DonorId) Com on PerC.UniqueId = Com.DonorId join (select Don.DonorId, count(Don.UniqueId) Q from Donations Don join ref.DonationTypes DonT on Don.DonationTypeId = DonT.UniqueId where DonT.ComponentType = 2 and Don.IsDeleted = 0 and Don.UniqueId not in (select DonCom.DonationId from DonationComplications DonCom join ref.DonationComplicationTypes DonComT on DonCom.ComplicationTypeGuid = DonComT.Guid where DonComT.CalculateDonation = 0) and DonT.ChargeType = 1 group by Don.DonorId) Pl on PerC.UniqueId = Pl.DonorId left join (select Don.DonorId, count(Don.UniqueId) Q from Donations Don join ref.DonationTypes DonT on Don.DonationTypeId = DonT.UniqueId where DonT.ComponentType in (1, 3, 4, 5) and Don.IsDeleted = 0 and Don.UniqueId not in (select DonCom.DonationId from DonationComplications DonCom join ref.DonationComplicationTypes DonComT on DonCom.ComplicationTypeGuid = DonComT.Guid where DonComT.CalculateDonation = 0) and DonT.ChargeType = 1 group by Don.DonorId) Bl on PerC.UniqueId = Bl.DonorId where PerC.IsDeleted != 1 and Com.Q < SysSet.MaxYearBloodDonationCountFemale and Com.Q < SysSet.MaxYearBloodDonationCountMale and PerC.BirthDateIsUndefined = 0 and PerC.DeathDate is null and PerC.UniqueId not in (select PrReg.DonorId from DonationProcessRegistry PrReg where PrReg.RegDate = cast(getdate() as date)) and PerC.UniqueId not in (select Don.DonorId from Donations Don where cast(Don.DonationDate as date) = cast(getdate() as date)) and PerC.UniqueId not in (select Def.DonorId from Deferrals Def join ref.DeferralTypes DefT on Def.DeferralTypeId = DefT.UniqueId where ((DefT.BaseType in (1, 2) and Def.RevokeDate is null) or (DefT.BaseType = 3 and cast(Def.StopDate as date) >= cast(getdate() as date)))) and PerC.UniqueId not in (select MaxDon.DonorId from Donations Don join (select Don.DonorId, max(Don.DonationDate) MaxDate from Donations Don, ref.SystemSettings SysSet where Don.OrgId = SysSet.CurrentOrganizationId group by Don.DonorId) MaxDon on Don.DonorId = MaxDon.DonorId and Don.DonationDate = MaxDon.MaxDate join DonationTestResults DonTest on Don.UniqueId = DonTest.DonationId where DonTest.TestTypeId = 42 and DonTest.TestValue = 13) and PerC.Gender in (1,2) and PerC.IdentityDocId is not null and ((PerC.RegAddressId is not null and PerC.RegAddressIsInactive = 0) or (PerC.FactAddressId is not null and PerC.FactAddressIsInactive = 0) or (PerC.TempAddressId is not null and PerC.TempAddressIsInactive = 0)) and DonTP.IsActive = 1 and DonT.DonationParams not in (4, 5, 6, 7, 12, 15) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType = 2) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType in (3, 4) and MedTT.BloodTestCategory != 10) and DonT.ComponentType = 1 and DonT.ChargeType not in (0, 3) and PerC.UniqueId != HonD.DonorId and Pl.Q between 1 and 10",2
"select top(1) PerC.UniqueId Ent, 'Донор является потенциально почетным по количеству сданных донаций' OR1, 2 NumStr, Pl.Q + Bl.Q - 1 Al, Bl.Q - 2 Bl, Pl.Q - 1 Pl from ref.SystemSettings SysSet, HonorableDonors HonD, PersonCards PerC join AppointedDonationTypes AppD on PerC.UniqueId = AppD.DonorId join (select AppD.DonorId, max(AppD.DonationDate) MaxDate from AppointedDonationTypes AppD group by AppD.DonorId) Main on AppD.DonorId = Main.DonorId and AppD.DonationDate = Main.MaxDate join ref.DonationTypeParams DonTP on AppD.DonationTypeId = DonTP.DonationTypeId join ref.DonationTypes DonT on AppD.DonationTypeId = DonT.UniqueId join (select Don.DonorId, count(Don.UniqueId) Q from Donations Don join ref.DonationTypes DonT on Don.DonationTypeId = DonT.UniqueId where DonT.ComponentType = 1 and Don.IsDeleted = 0 and Don.UniqueId not in (select DonCom.DonationId from DonationComplications DonCom join ref.DonationComplicationTypes DonComT on DonCom.ComplicationTypeGuid = DonComT.Guid where DonComT.CalculateDonation = 0) and cast(Don.DonationDate as date) > dateadd(year, -1, cast(getdate() as date)) group by Don.DonorId) Com on PerC.UniqueId = Com.DonorId join (select Don.DonorId, count(Don.UniqueId) Q from  Donations Don join ref.DonationTypes DonT on Don.DonationTypeId = DonT.UniqueId where DonT.ComponentType in (1, 3, 4, 5) and Don.IsDeleted = 0 and Don.UniqueId not in (select DonCom.DonationId from DonationComplications DonCom join ref.DonationComplicationTypes DonComT on DonCom.ComplicationTypeGuid = DonComT.Guid where DonComT.CalculateDonation = 0) and DonT.ChargeType = 1 group by Don.DonorId) Bl on PerC.UniqueId = Bl.DonorId join (select Don.DonorId, count(Don.UniqueId) Q from Donations Don join ref.DonationTypes DonT on Don.DonationTypeId = DonT.UniqueId where DonT.ComponentType = 2 and Don.IsDeleted = 0 and Don.UniqueId not in (select DonCom.DonationId from DonationComplications DonCom join ref.DonationComplicationTypes DonComT on DonCom.ComplicationTypeGuid = DonComT.Guid where DonComT.CalculateDonation = 0) and DonT.ChargeType = 1 group by Don.DonorId) Pl on PerC.UniqueId = Pl.DonorId where PerC.IsDeleted != 1 and Com.Q < SysSet.MaxYearBloodDonationCountFemale and Com.Q < SysSet.MaxYearBloodDonationCountMale and PerC.BirthDateIsUndefined = 0 and PerC.DeathDate is null and PerC.UniqueId not in (select PrReg.DonorId from DonationProcessRegistry PrReg where PrReg.RegDate = cast(getdate() as date)) and PerC.UniqueId not in (select Don.DonorId from Donations Don where cast(Don.DonationDate as date) = cast(getdate() as date)) and PerC.UniqueId not in (select Def.DonorId from Deferrals Def join ref.DeferralTypes DefT on Def.DeferralTypeId = DefT.UniqueId where ((DefT.BaseType in (1, 2) and Def.RevokeDate is null) or (DefT.BaseType = 3 and cast(Def.StopDate as date) >= cast(getdate() as date)))) and PerC.UniqueId not in (select MaxDon.DonorId from Donations Don join (select Don.DonorId, max(Don.DonationDate) MaxDate from Donations Don, ref.SystemSettings SysSet where Don.OrgId = SysSet.CurrentOrganizationId group by Don.DonorId) MaxDon on Don.DonorId = MaxDon.DonorId and Don.DonationDate = MaxDon.MaxDate join DonationTestResults DonTest on Don.UniqueId = DonTest.DonationId where DonTest.TestTypeId = 42 and DonTest.TestValue = 13) and PerC.Gender in (1,2) and PerC.IdentityDocId is not null and ((PerC.RegAddressId is not null and PerC.RegAddressIsInactive = 0) or (PerC.FactAddressId is not null and PerC.FactAddressIsInactive = 0) or (PerC.TempAddressId is not null and PerC.TempAddressIsInactive = 0)) and DonTP.IsActive = 1 and DonT.DonationParams not in (4, 5, 6, 7, 12, 15) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType = 2) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType in (3, 4) and MedTT.BloodTestCategory != 10) and DonT.ComponentType = 1 and DonT.ChargeType not in (0, 3) and PerC.UniqueId != HonD.DonorId and Pl.Q < 999 and Bl.Q < 999",3
"select top(1) PerC.UniqueId Ent, 'Донор является потенциально почетным по количеству сданных донаций' OR1, 3 NumStr, Pl.Q + Bl.Q Al, Bl.Q Bl, Pl.Q Pl from ref.SystemSettings SysSet, HonorableDonors HonD, PersonCards PerC join AppointedDonationTypes AppD on PerC.UniqueId = AppD.DonorId join (select AppD.DonorId, max(AppD.DonationDate) MaxDate from AppointedDonationTypes AppD group by AppD.DonorId) Main on AppD.DonorId = Main.DonorId and AppD.DonationDate = Main.MaxDate join ref.DonationTypeParams DonTP on AppD.DonationTypeId = DonTP.DonationTypeId join ref.DonationTypes DonT on AppD.DonationTypeId = DonT.UniqueId join (select Don.DonorId, count(Don.UniqueId) Q from Donations Don join ref.DonationTypes DonT on Don.DonationTypeId = DonT.UniqueId where DonT.ComponentType = 1 and Don.IsDeleted = 0 and Don.UniqueId not in (select DonCom.DonationId from DonationComplications DonCom join ref.DonationComplicationTypes DonComT on DonCom.ComplicationTypeGuid = DonComT.Guid where DonComT.CalculateDonation = 0) and cast(Don.DonationDate as date) > dateadd(year, -1, cast(getdate() as date)) group by Don.DonorId) Com on PerC.UniqueId = Com.DonorId join (select Don.DonorId, count(Don.UniqueId) Q from  Donations Don join ref.DonationTypes DonT on Don.DonationTypeId = DonT.UniqueId where DonT.ComponentType in (1, 3, 4, 5) and Don.IsDeleted = 0 and Don.UniqueId not in (select DonCom.DonationId from DonationComplications DonCom join ref.DonationComplicationTypes DonComT on DonCom.ComplicationTypeGuid = DonComT.Guid where DonComT.CalculateDonation = 0) and DonT.ChargeType = 1 group by Don.DonorId) Bl on PerC.UniqueId = Bl.DonorId join (select Don.DonorId, count(Don.UniqueId) Q from Donations Don join ref.DonationTypes DonT on Don.DonationTypeId = DonT.UniqueId where DonT.ComponentType = 2 and Don.IsDeleted = 0 and Don.UniqueId not in (select DonCom.DonationId from DonationComplications DonCom join ref.DonationComplicationTypes DonComT on DonCom.ComplicationTypeGuid = DonComT.Guid where DonComT.CalculateDonation = 0) and DonT.ChargeType = 1 group by Don.DonorId) Pl on PerC.UniqueId = Pl.DonorId where PerC.IsDeleted != 1 and Com.Q < SysSet.MaxYearBloodDonationCountFemale and Com.Q < SysSet.MaxYearBloodDonationCountMale and PerC.BirthDateIsUndefined = 0 and PerC.DeathDate is null and PerC.UniqueId not in (select PrReg.DonorId from DonationProcessRegistry PrReg where PrReg.RegDate = cast(getdate() as date)) and PerC.UniqueId not in (select Don.DonorId from Donations Don where cast(Don.DonationDate as date) = cast(getdate() as date)) and PerC.UniqueId not in (select Def.DonorId from Deferrals Def join ref.DeferralTypes DefT on Def.DeferralTypeId = DefT.UniqueId where ((DefT.BaseType in (1, 2) and Def.RevokeDate is null) or (DefT.BaseType = 3 and cast(Def.StopDate as date) >= cast(getdate() as date)))) and PerC.UniqueId not in (select MaxDon.DonorId from Donations Don join (select Don.DonorId, max(Don.DonationDate) MaxDate from Donations Don, ref.SystemSettings SysSet where Don.OrgId = SysSet.CurrentOrganizationId group by Don.DonorId) MaxDon on Don.DonorId = MaxDon.DonorId and Don.DonationDate = MaxDon.MaxDate join DonationTestResults DonTest on Don.UniqueId = DonTest.DonationId where DonTest.TestTypeId = 42 and DonTest.TestValue = 13) and PerC.Gender in (1,2) and PerC.IdentityDocId is not null and ((PerC.RegAddressId is not null and PerC.RegAddressIsInactive = 0) or (PerC.FactAddressId is not null and PerC.FactAddressIsInactive = 0) or (PerC.TempAddressId is not null and PerC.TempAddressIsInactive = 0)) and DonTP.IsActive = 1 and DonT.DonationParams not in (4, 5, 6, 7, 12, 15) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType = 2) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType in (3, 4) and MedTT.BloodTestCategory != 10) and DonT.ComponentType = 1 and DonT.ChargeType not in (0, 3) and cast(AppD.NextDonationDate as date) <= cast(getdate() as date) and PerC.UniqueId != HonD.DonorId and Pl.Q < 999 and Bl.Q < 999",4