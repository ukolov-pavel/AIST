query, test_data_set_number
"select top(1) PerC.UniqueId Ent from ref.SystemSettings SysSet, PersonCards PerC join AppointedDonationTypes AppD on PerC.UniqueId = AppD.DonorId join (select AppD.DonorId, max(AppD.DonationDate) MaxDate from AppointedDonationTypes AppD group by AppD.DonorId) Main on AppD.DonorId = Main.DonorId and AppD.DonationDate = Main.MaxDate join ref.DonationTypeParams DonTP on AppD.DonationTypeId = DonTP.DonationTypeId join ref.DonationTypes DonT on AppD.DonationTypeId = DonT.UniqueId join Deferrals Def on PerC.UniqueId = Def.DonorId and Def.RevokeDate is not null join ref.DeferralTypes DefT on Def.DeferralTypeId = DefT.UniqueId and DefT.BaseType = 1 left join EpidControls Epid1 on PerC.RegAddressId = Epid1.PersonAddressId left join EpidControls Epid2 on PerC.FactAddressId = Epid2.PersonAddressId left join EpidControls Epid3 on PerC.TempAddressId = Epid3.PersonAddressId left join PersonMedicalNotes Nt on PerC.UniqueId = Nt.DonorId where PerC.IsDeleted != 1 and cast(PerC.BirthDate as date) > cast(dateadd(year, -SysSet.DonorMaxAge, getdate()) as date) and cast(PerC.BirthDate as date) < cast(dateadd(year, -SysSet.DonorMinAge, getdate()) as date) and PerC.BirthDateIsUndefined = 0 and PerC.DeathDate is null and PerC.UniqueId not in (select PrReg.DonorId from DonationProcessRegistry PrReg where PrReg.RegDate = cast(getdate() as date) and PrReg.CurrentState != 6) and PerC.UniqueId not in (select Don.DonorId from Donations Don where cast(Don.DonationDate as date) = cast(getdate() as date)) and PerC.UniqueId not in (select Def.DonorId from Deferrals Def join ref.DeferralTypes DefT on Def.DeferralTypeId = DefT.UniqueId where ((DefT.BaseType in (1, 2) and Def.RevokeDate is null) or (DefT.BaseType = 3 and (cast(Def.StopDate as date) >= cast(getdate() as date) or Def.StopDate is null)))) and PerC.UniqueId not in (select MaxDon.DonorId from Donations Don join (select Don.DonorId, max(Don.DonationDate) MaxDate from Donations Don, ref.SystemSettings SysSet where Don.OrgId = SysSet.CurrentOrganizationId group by Don.DonorId) MaxDon on Don.DonorId = MaxDon.DonorId and Don.DonationDate != MaxDon.MaxDate join DonationTestResults DonTest on Don.UniqueId = DonTest.DonationId where DonTest.TestTypeId = 42 and DonTest.TestValue = 13) and PerC.Gender in (1,2) and PerC.IdentityDocId is not null and ((PerC.RegAddressId is not null and (PerC.RegAddressIsInactive = 0 or PerC.RegAddressIsInactive is null)) or (PerC.FactAddressId is not null and (PerC.FactAddressIsInactive = 0 or PerC.FactAddressIsInactive is null)) or (PerC.TempAddressId is not null and (PerC.TempAddressIsInactive = 0 or PerC.TempAddressIsInactive is null))) and Epid1.Id is null and Epid2.Id is null and Epid3.Id is null and DonTP.IsActive = 1 and DonT.DonationParams not in (4, 5, 6, 7, 12, 15) and (cast(AppD.NextDonationDate as date) <= cast(getdate() as date) or AppD.NextDonationDate is null) and (Nt.AssignedTo not in (1, 3, 5, 7, 17, 19, 21, 23) or (Nt.IsFixed != 1 and cast(Nt.CreateDate as date) != cast(getdate() as date)) or Nt.UniqueId is null) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType = 2) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id 	and MedTT.ExamType in (3, 4) and MedTT.BloodTestCategory != 10) and DonT.ChargeType not in (0, 3) and PerC.UniqueId not in (select Don.DonorId from Donations Don where Don.ResultStatus != 5)",1
"select top(1) PerC.UniqueId Ent from ref.SystemSettings SysSet, PersonCards PerC join AppointedDonationTypes AppD on PerC.UniqueId = AppD.DonorId join (select AppD.DonorId, max(AppD.DonationDate) MaxDate from AppointedDonationTypes AppD group by AppD.DonorId) Main on AppD.DonorId = Main.DonorId and AppD.DonationDate = Main.MaxDate join ref.DonationTypeParams DonTP on AppD.DonationTypeId = DonTP.DonationTypeId join ref.DonationTypes DonT on AppD.DonationTypeId = DonT.UniqueId join DonationProcessRegistry PrReg on PerC.UniqueId = PrReg.DonorId left join PersonMedicalNotes Nt on PerC.UniqueId = Nt.DonorId left join EpidControls Epid1 on PerC.RegAddressId = Epid1.PersonAddressId left join EpidControls Epid2 on PerC.FactAddressId = Epid2.PersonAddressId left join EpidControls Epid3 on PerC.TempAddressId = Epid3.PersonAddressId where PerC.IsDeleted != 1 and cast(PerC.BirthDate as date) > cast(dateadd(year, -SysSet.DonorMaxAge, getdate()) as date) and cast(PerC.BirthDate as date) < cast(dateadd(year, -SysSet.DonorMinAge, getdate()) as date) and PerC.BirthDateIsUndefined = 0 and PerC.DeathDate is null and PerC.UniqueId not in (select PrReg.DonorId from DonationProcessRegistry PrReg where PrReg.RegDate = cast(getdate() as date) and PrReg.CurrentState != 6) and PerC.UniqueId not in (select Don.DonorId from Donations Don where cast(Don.DonationDate as date) = cast(getdate() as date)) and PerC.UniqueId not in (select Def.DonorId from Deferrals Def join ref.DeferralTypes DefT on Def.DeferralTypeId = DefT.UniqueId where ((DefT.BaseType in (1, 2) and Def.RevokeDate is null) or (DefT.BaseType = 3 and (cast(Def.StopDate as date) >= cast(getdate() as date) or Def.StopDate is null)))) and PerC.UniqueId not in (select MaxDon.DonorId from Donations Don join (select Don.DonorId, max(Don.DonationDate) MaxDate from Donations Don, ref.SystemSettings SysSet where Don.OrgId = SysSet.CurrentOrganizationId group by Don.DonorId) MaxDon on Don.DonorId = MaxDon.DonorId and Don.DonationDate = MaxDon.MaxDate join DonationTestResults DonTest on Don.UniqueId = DonTest.DonationId where DonTest.TestTypeId = 42 and DonTest.TestValue = 13) and PerC.Gender in (1,2) and PerC.IdentityDocId is not null and ((PerC.RegAddressId is not null and PerC.RegAddressIsInactive = 0) or (PerC.FactAddressId is not null and PerC.FactAddressIsInactive = 0) 	or (PerC.TempAddressId is not null and PerC.TempAddressIsInactive = 0)) and Epid1.Id is null and Epid2.Id is null and Epid3.Id is null and DonTP.IsActive = 1 and DonT.DonationParams not in (4, 5, 6, 7, 12, 15) and DonT.UniqueId in (select DonTest.DonationTypeId	from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType = 2) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType in (3, 4) and MedTT.BloodTestCategory != 10) and DonT.ChargeType not in (0, 3) and cast(AppD.NextDonationDate as date) <= cast(getdate() as date) and (Nt.AssignedTo not in (1, 3, 5, 7, 17, 19, 21, 23) or (Nt.IsFixed != 1 and cast(Nt.CreateDate as date) != cast(getdate() as date))) and PrReg.RegDate != cast(getdate() as date) and PrReg.MobileTeamSessionId is not null and PrReg.CurrentState != 6 and PerC.UniqueId not in (select Don.DonorId from Donations Don where Don.ResultStatus != 5)",2
"select top(1) PerC.UniqueId Ent from ref.SystemSettings SysSet, PersonCards PerC join AppointedDonationTypes AppD on PerC.UniqueId = AppD.DonorId join (select AppD.DonorId, max(AppD.DonationDate) MaxDate from AppointedDonationTypes AppD group by AppD.DonorId) Main on AppD.DonorId = Main.DonorId and AppD.DonationDate = Main.MaxDate join ref.DonationTypeParams DonTP on AppD.DonationTypeId = DonTP.DonationTypeId join ref.DonationTypes DonT on AppD.DonationTypeId = DonT.UniqueId join DonationProcessRegistry PrReg on PerC.UniqueId = PrReg.DonorId left join EpidControls Epid1 on PerC.RegAddressId = Epid1.PersonAddressId left join EpidControls Epid2 on PerC.FactAddressId = Epid2.PersonAddressId left join EpidControls Epid3 on PerC.TempAddressId = Epid3.PersonAddressId left join PersonMedicalNotes Nt on PerC.UniqueId = Nt.DonorId where PerC.IsDeleted != 1 and cast(PerC.BirthDate as date) > cast(dateadd(year, -SysSet.DonorMaxAge, getdate()) as date) and cast(PerC.BirthDate as date) < cast(dateadd(year, -SysSet.DonorMinAge, getdate()) as date) and PerC.BirthDateIsUndefined = 0 and PerC.DeathDate is null and PerC.UniqueId not in (select Don.DonorId from Donations Don where cast(Don.DonationDate as date) = cast(getdate() as date)) and PerC.UniqueId not in (select Def.DonorId from Deferrals Def join ref.DeferralTypes DefT on Def.DeferralTypeId = DefT.UniqueId where ((DefT.BaseType in (1, 2) and Def.RevokeDate is null) or (DefT.BaseType = 3 and (cast(Def.StopDate as date) >= cast(getdate() as date) or Def.StopDate is null)))) and PerC.UniqueId not in (select MaxDon.DonorId from Donations Don join (select Don.DonorId, max(Don.DonationDate) MaxDate from Donations Don, ref.SystemSettings SysSet where Don.OrgId = SysSet.CurrentOrganizationId group by Don.DonorId) MaxDon on Don.DonorId = MaxDon.DonorId and Don.DonationDate = MaxDon.MaxDate join DonationTestResults DonTest on Don.UniqueId = DonTest.DonationId where DonTest.TestTypeId = 42 and DonTest.TestValue = 13) and PerC.Gender in (1,2) and PerC.IdentityDocId is not null and ((PerC.RegAddressId is not null and (PerC.RegAddressIsInactive = 0 or PerC.RegAddressIsInactive is null)) or (PerC.FactAddressId is not null and (PerC.FactAddressIsInactive = 0 or PerC.FactAddressIsInactive is null)) or (PerC.TempAddressId is not null and (PerC.TempAddressIsInactive = 0 or PerC.TempAddressIsInactive is null))) and Epid1.Id is null and Epid2.Id is null and Epid3.Id is null and DonTP.IsActive = 1 and DonT.DonationParams not in (4, 5, 6, 7, 12, 15) and (cast(AppD.NextDonationDate as date) <= cast(getdate() as date) or AppD.NextDonationDate is null) and (Nt.AssignedTo not in (1, 3, 5, 7, 17, 19, 21, 23) or (Nt.IsFixed != 1 and cast(Nt.CreateDate as date) != cast(getdate() as date)) or Nt.UniqueId is null) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType = 2) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType in (3, 4) and MedTT.BloodTestCategory != 10) and PrReg.RegDate = cast(getdate() as date) and PrReg.MobileTeamSessionId is not null and PrReg.CurrentState = 6 and PerC.UniqueId not in (select Don.DonorId from Donations Don where Don.ResultStatus != 5)",3
"select top(1) PerC.UniqueId Ent from ref.SystemSettings SysSet, PersonCards PerC join AppointedDonationTypes AppD on PerC.UniqueId = AppD.DonorId join (select AppD.DonorId, max(AppD.DonationDate) MaxDate from AppointedDonationTypes AppD group by AppD.DonorId) Main on AppD.DonorId = Main.DonorId and AppD.DonationDate = Main.MaxDate join ref.DonationTypeParams DonTP on AppD.DonationTypeId = DonTP.DonationTypeId join ref.DonationTypes DonT on AppD.DonationTypeId = DonT.UniqueId left join EpidControls Epid1 on PerC.RegAddressId = Epid1.PersonAddressId left join EpidControls Epid2 on PerC.FactAddressId = Epid2.PersonAddressId left join EpidControls Epid3 on PerC.TempAddressId = Epid3.PersonAddressId left join PersonMedicalNotes Nt on PerC.UniqueId = Nt.DonorId where PerC.IsDeleted != 1 and cast(PerC.BirthDate as date) > cast(dateadd(year, -SysSet.DonorMaxAge, getdate()) as date) and cast(PerC.BirthDate as date) < cast(dateadd(year, -SysSet.DonorMinAge, getdate()) as date) and PerC.BirthDateIsUndefined = 0 and PerC.DeathDate is null and PerC.UniqueId not in (select PrReg.DonorId from DonationProcessRegistry PrReg where PrReg.RegDate = cast(getdate() as date) and PrReg.CurrentState != 6) and PerC.UniqueId not in (select Don.DonorId from Donations Don where cast(Don.DonationDate as date) = cast(getdate() as date)) and PerC.UniqueId not in (select Def.DonorId from Deferrals Def join ref.DeferralTypes DefT on Def.DeferralTypeId = DefT.UniqueId where ((DefT.BaseType in (1, 2) and Def.RevokeDate is null) or (DefT.BaseType = 3 and (cast(Def.StopDate as date) >= cast(getdate() as date) or Def.StopDate is null)))) and PerC.UniqueId not in (select MaxDon.DonorId from Donations Don join (select Don.DonorId, max(Don.DonationDate) MaxDate from Donations Don, ref.SystemSettings SysSet where Don.OrgId = SysSet.CurrentOrganizationId group by Don.DonorId) MaxDon on Don.DonorId = MaxDon.DonorId and Don.DonationDate = MaxDon.MaxDate join DonationTestResults DonTest on Don.UniqueId = DonTest.DonationId where DonTest.TestTypeId = 42 and DonTest.TestValue = 13) and PerC.Gender in (1,2) and PerC.IdentityDocId is not null and ((PerC.RegAddressId is not null and (PerC.RegAddressIsInactive = 0 or PerC.RegAddressIsInactive is null)) or (PerC.FactAddressId is not null and (PerC.FactAddressIsInactive = 0 or PerC.FactAddressIsInactive is null)) or (PerC.TempAddressId is not null and (PerC.TempAddressIsInactive = 0 or PerC.TempAddressIsInactive is null))) and Epid1.Id is null and Epid2.Id is null and Epid3.Id is null and DonTP.IsActive = 1 and DonT.DonationParams not in (4, 5, 6, 7, 12, 15) and (cast(AppD.NextDonationDate as date) <= cast(getdate() as date) or AppD.NextDonationDate is null) and (Nt.AssignedTo not in (1, 3, 5, 7, 17, 19, 21, 23) or (Nt.IsFixed != 1 and cast(Nt.CreateDate as date) != cast(getdate() as date)) or Nt.UniqueId is null) and (DonT.UniqueId not in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType = 2) or DonT.UniqueId not in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType in (3, 4) and MedTT.BloodTestCategory != 10)) and DonT.ChargeType = 3 and PerC.UniqueId not in (select Don.DonorId from Donations Don where Don.ResultStatus != 5)",4
"select top(1) PerC.UniqueId Ent from ref.SystemSettings SysSet, PersonCards PerC join AppointedDonationTypes AppD on PerC.UniqueId = AppD.DonorId join (select AppD.DonorId, max(AppD.DonationDate) MaxDate from AppointedDonationTypes AppD group by AppD.DonorId) Main on AppD.DonorId = Main.DonorId and AppD.DonationDate = Main.MaxDate join ref.DonationTypeParams DonTP on AppD.DonationTypeId = DonTP.DonationTypeId join ref.DonationTypes DonT on AppD.DonationTypeId = DonT.UniqueId left join EpidControls Epid1 on PerC.RegAddressId = Epid1.PersonAddressId left join EpidControls Epid2 on PerC.FactAddressId = Epid2.PersonAddressId left join EpidControls Epid3 on PerC.TempAddressId = Epid3.PersonAddressId left join PersonMedicalNotes Nt on PerC.UniqueId = Nt.DonorId where PerC.IsDeleted != 1 and cast(PerC.BirthDate as date) > cast(dateadd(year, -SysSet.DonorMaxAge, getdate()) as date) and cast(PerC.BirthDate as date) < cast(dateadd(year, -SysSet.DonorMinAge, getdate()) as date) and PerC.BirthDateIsUndefined = 0 and PerC.DeathDate is null and PerC.UniqueId not in (select PrReg.DonorId from DonationProcessRegistry PrReg where PrReg.RegDate = cast(getdate() as date) and PrReg.CurrentState != 6) and PerC.UniqueId not in (select Don.DonorId from Donations Don where cast(Don.DonationDate as date) = cast(getdate() as date)) and PerC.UniqueId not in (select Def.DonorId from Deferrals Def join ref.DeferralTypes DefT on Def.DeferralTypeId = DefT.UniqueId where ((DefT.BaseType in (1, 2) and Def.RevokeDate is null) or (DefT.BaseType = 3 and (cast(Def.StopDate as date) >= cast(getdate() as date) or Def.StopDate is null)))) and PerC.UniqueId not in (select MaxDon.DonorId from Donations Don join (select Don.DonorId, max(Don.DonationDate) MaxDate from Donations Don, ref.SystemSettings SysSet where Don.OrgId = SysSet.CurrentOrganizationId group by Don.DonorId) MaxDon on Don.DonorId = MaxDon.DonorId and Don.DonationDate = MaxDon.MaxDate join DonationTestResults DonTest on Don.UniqueId = DonTest.DonationId where DonTest.TestTypeId = 42 and DonTest.TestValue = 13) and PerC.Gender in (1,2) and PerC.IdentityDocId is not null and ((PerC.RegAddressId is not null and (PerC.RegAddressIsInactive = 0 or PerC.RegAddressIsInactive is null)) or (PerC.FactAddressId is not null and (PerC.FactAddressIsInactive = 0 or PerC.FactAddressIsInactive is null)) or (PerC.TempAddressId is not null and (PerC.TempAddressIsInactive = 0 or PerC.TempAddressIsInactive is null))) and Epid1.Id is null and Epid2.Id is null and Epid3.Id is null and DonTP.IsActive = 1 and DonT.DonationParams not in (4, 5, 6, 7, 12, 15) and (cast(AppD.NextDonationDate as date) <= cast(getdate() as date) or AppD.NextDonationDate is null) and (Nt.AssignedTo not in (1, 3, 5, 7, 17, 19, 21, 23) or (Nt.IsFixed != 1 and cast(Nt.CreateDate as date) != cast(getdate() as date)) or Nt.UniqueId is null) and (DonT.UniqueId not in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType = 2) or DonT.UniqueId not in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType in (3, 4) and MedTT.BloodTestCategory != 10)) and DonT.ChargeType = 0 and PerC.UniqueId not in (select Don.DonorId from Donations Don where Don.ResultStatus != 5)",5
"select top(1) PerC.UniqueId Ent from ref.SystemSettings SysSet, PersonCards PerC join AppointedDonationTypes AppD on PerC.UniqueId = AppD.DonorId join (select AppD.DonorId, max(AppD.DonationDate) MaxDate from AppointedDonationTypes AppD group by AppD.DonorId) Main on AppD.DonorId = Main.DonorId and AppD.DonationDate = Main.MaxDate join ref.DonationTypeParams DonTP on AppD.DonationTypeId = DonTP.DonationTypeId join ref.DonationTypes DonT on AppD.DonationTypeId = DonT.UniqueId left join EpidControls Epid1 on PerC.RegAddressId = Epid1.PersonAddressId left join EpidControls Epid2 on PerC.FactAddressId = Epid2.PersonAddressId left join EpidControls Epid3 on PerC.TempAddressId = Epid3.PersonAddressId left join PersonMedicalNotes Nt on PerC.UniqueId = Nt.DonorId where PerC.IsDeleted != 1 and cast(PerC.BirthDate as date) > cast(dateadd(year, -SysSet.DonorMaxAge, getdate()) as date) and cast(PerC.BirthDate as date) < cast(dateadd(year, -SysSet.DonorMinAge, getdate()) as date) and PerC.BirthDateIsUndefined = 0 and PerC.DeathDate is null and PerC.UniqueId not in (select PrReg.DonorId from DonationProcessRegistry PrReg where PrReg.RegDate = cast(getdate() as date) and PrReg.CurrentState != 6) and PerC.UniqueId not in (select Don.DonorId from Donations Don where cast(Don.DonationDate as date) = cast(getdate() as date)) and PerC.UniqueId in (select Don.DonorId from Donations Don where cast(Don.DonationDate as date) != cast(getdate() as date)) and PerC.UniqueId not in (select Def.DonorId from Deferrals Def join ref.DeferralTypes DefT on Def.DeferralTypeId = DefT.UniqueId where ((DefT.BaseType in (1, 2) and Def.RevokeDate is null) or (DefT.BaseType = 3 and (cast(Def.StopDate as date) >= cast(getdate() as date) or Def.StopDate is null)))) and PerC.UniqueId not in (select MaxDon.DonorId from Donations Don join (select Don.DonorId, max(Don.DonationDate) MaxDate from Donations Don, ref.SystemSettings SysSet where Don.OrgId = SysSet.CurrentOrganizationId group by Don.DonorId) MaxDon on Don.DonorId = MaxDon.DonorId and Don.DonationDate = MaxDon.MaxDate join DonationTestResults DonTest on Don.UniqueId = DonTest.DonationId where DonTest.TestTypeId = 42 and DonTest.TestValue = 13) and PerC.Gender in (1,2) and PerC.IdentityDocId is not null and ((PerC.RegAddressId is not null and (PerC.RegAddressIsInactive = 0 or PerC.RegAddressIsInactive is null)) or (PerC.FactAddressId is not null and (PerC.FactAddressIsInactive = 0 or PerC.FactAddressIsInactive is null)) or (PerC.TempAddressId is not null and (PerC.TempAddressIsInactive = 0 or PerC.TempAddressIsInactive is null))) and Epid1.Id is null and Epid2.Id is null and Epid3.Id is null and DonTP.IsActive = 1 and DonT.DonationParams not in (4, 5, 6, 7, 12, 15) and (cast(AppD.NextDonationDate as date) <= cast(getdate() as date) or AppD.NextDonationDate is null) and (Nt.AssignedTo not in (1, 3, 5, 7, 17, 19, 21, 23) or (Nt.IsFixed != 1 and cast(Nt.CreateDate as date) != cast(getdate() as date)) or Nt.UniqueId is null) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType = 2) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType in (3, 4) and MedTT.BloodTestCategory != 10) and DonT.ChargeType not in (0, 3) and PerC.UniqueId not in (select Don.DonorId from Donations Don where Don.ResultStatus != 5)",6
"select top(1) PerC.UniqueId Ent from ref.SystemSettings SysSet, PersonCards PerC join AppointedDonationTypes AppD on PerC.UniqueId = AppD.DonorId join (select AppD.DonorId, max(AppD.DonationDate) MaxDate from AppointedDonationTypes AppD group by AppD.DonorId) Main on AppD.DonorId = Main.DonorId and AppD.DonationDate = Main.MaxDate join ref.DonationTypeParams DonTP on AppD.DonationTypeId = DonTP.DonationTypeId join ref.DonationTypes DonT on AppD.DonationTypeId = DonT.UniqueId left join EpidControls Epid1 on PerC.RegAddressId = Epid1.PersonAddressId left join EpidControls Epid2 on PerC.FactAddressId = Epid2.PersonAddressId left join EpidControls Epid3 on PerC.TempAddressId = Epid3.PersonAddressId left join PersonMedicalNotes Nt on PerC.UniqueId = Nt.DonorId where PerC.IsDeleted != 1 and cast(PerC.BirthDate as date) > cast(dateadd(year, -SysSet.DonorMaxAge, getdate()) as date) and cast(PerC.BirthDate as date) < cast(dateadd(year, -SysSet.DonorMinAge, getdate()) as date) and PerC.BirthDateIsUndefined = 0 and PerC.DeathDate is null and PerC.UniqueId not in (select PrReg.DonorId from DonationProcessRegistry PrReg where PrReg.RegDate = cast(getdate() as date) and PrReg.CurrentState != 6) and PerC.UniqueId not in (select Don.DonorId from Donations Don where cast(Don.DonationDate as date) = cast(getdate() as date)) and PerC.UniqueId not in (select Def.DonorId from Deferrals Def join ref.DeferralTypes DefT on Def.DeferralTypeId = DefT.UniqueId where ((DefT.BaseType in (1, 2) and Def.RevokeDate is null) or (DefT.BaseType = 3 and (cast(Def.StopDate as date) >= cast(getdate() as date) or Def.StopDate is null)))) and PerC.UniqueId in (select MaxDon.DonorId from Donations Don join (select Don.DonorId, max(Don.DonationDate) MaxDate from Donations Don, ref.SystemSettings SysSet where Don.OrgId = SysSet.CurrentOrganizationId group by Don.DonorId) MaxDon on Don.DonorId = MaxDon.DonorId and Don.DonationDate = MaxDon.MaxDate join DonationTestResults DonTest on Don.UniqueId = DonTest.DonationId where DonTest.TestTypeId = 42 and DonTest.TestValue = 13) and PerC.Gender in (1,2) and PerC.IdentityDocId is not null and ((PerC.RegAddressId is not null and (PerC.RegAddressIsInactive = 0 or PerC.RegAddressIsInactive is null)) or (PerC.FactAddressId is not null and (PerC.FactAddressIsInactive = 0 or PerC.FactAddressIsInactive is null)) or (PerC.TempAddressId is not null and (PerC.TempAddressIsInactive = 0 or PerC.TempAddressIsInactive is null))) and Epid1.Id is null and Epid2.Id is null and Epid3.Id is null and DonTP.IsActive = 1 and DonT.DonationParams not in (4, 5, 6, 7, 12, 15) and (cast(AppD.NextDonationDate as date) <= cast(getdate() as date) or AppD.NextDonationDate is null) and (Nt.AssignedTo not in (1, 3, 5, 7, 17, 19, 21, 23) or (Nt.IsFixed != 1 and cast(Nt.CreateDate as date) != cast(getdate() as date)) or Nt.UniqueId is null) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType = 2) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType in (3, 4) and MedTT.BloodTestCategory != 10) and DonT.ChargeType not in (0, 3) and PerC.UniqueId not in (select Don.DonorId from Donations Don where Don.ResultStatus != 5)",7
"select top(1) PerC.UniqueId Ent from ref.SystemSettings SysSet, PersonCards PerC join AppointedDonationTypes AppD on PerC.UniqueId = AppD.DonorId join (select AppD.DonorId, max(AppD.DonationDate) MaxDate from AppointedDonationTypes AppD group by AppD.DonorId) Main on AppD.DonorId = Main.DonorId and AppD.DonationDate = Main.MaxDate join ref.DonationTypeParams DonTP on AppD.DonationTypeId = DonTP.DonationTypeId join ref.DonationTypes DonT on AppD.DonationTypeId = DonT.UniqueId join Deferrals Def on PerC.UniqueId = Def.DonorId and Def.RevokeDate is not null join ref.DeferralTypes DefT on Def.DeferralTypeId = DefT.UniqueId and DefT.BaseType = 2 left join EpidControls Epid1 on PerC.RegAddressId = Epid1.PersonAddressId left join EpidControls Epid2 on PerC.FactAddressId = Epid2.PersonAddressId left join EpidControls Epid3 on PerC.TempAddressId = Epid3.PersonAddressId left join PersonMedicalNotes Nt on PerC.UniqueId = Nt.DonorId where PerC.IsDeleted != 1 and cast(PerC.BirthDate as date) > cast(dateadd(year, -SysSet.DonorMaxAge, getdate()) as date) and cast(PerC.BirthDate as date) < cast(dateadd(year, -SysSet.DonorMinAge, getdate()) as date) and PerC.BirthDateIsUndefined = 0 and PerC.DeathDate is null and PerC.UniqueId not in (select PrReg.DonorId from DonationProcessRegistry PrReg where PrReg.RegDate = cast(getdate() as date) and PrReg.CurrentState != 6) and PerC.UniqueId not in (select Don.DonorId from Donations Don where cast(Don.DonationDate as date) = cast(getdate() as date)) and PerC.UniqueId not in (select Def.DonorId from Deferrals Def join ref.DeferralTypes DefT on Def.DeferralTypeId = DefT.UniqueId where ((DefT.BaseType in (1, 2) and Def.RevokeDate is null) or (DefT.BaseType = 3 and (cast(Def.StopDate as date) >= cast(getdate() as date) or Def.StopDate is null)))) and PerC.UniqueId not in (select MaxDon.DonorId from Donations Don join (select Don.DonorId, max(Don.DonationDate) MaxDate from Donations Don, ref.SystemSettings SysSet where Don.OrgId = SysSet.CurrentOrganizationId group by Don.DonorId) MaxDon on Don.DonorId = MaxDon.DonorId and Don.DonationDate != MaxDon.MaxDate join DonationTestResults DonTest on Don.UniqueId = DonTest.DonationId where DonTest.TestTypeId = 42 and DonTest.TestValue = 13) and PerC.Gender in (1,2) and PerC.IdentityDocId is not null and ((PerC.RegAddressId is not null and (PerC.RegAddressIsInactive = 0 or PerC.RegAddressIsInactive is null)) or (PerC.FactAddressId is not null and (PerC.FactAddressIsInactive = 0 or PerC.FactAddressIsInactive is null)) or (PerC.TempAddressId is not null and (PerC.TempAddressIsInactive = 0 or PerC.TempAddressIsInactive is null))) and Epid1.Id is null and Epid2.Id is null and Epid3.Id is null and DonTP.IsActive = 1 and DonT.DonationParams not in (4, 5, 6, 7, 12, 15) and (cast(AppD.NextDonationDate as date) <= cast(getdate() as date) or AppD.NextDonationDate is null) and (Nt.AssignedTo not in (1, 3, 5, 7, 17, 19, 21, 23) or (Nt.IsFixed != 1 and cast(Nt.CreateDate as date) != cast(getdate() as date)) or Nt.UniqueId is null) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType = 2) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType in (3, 4) and MedTT.BloodTestCategory != 10) and DonT.ChargeType not in (0, 3) and PerC.UniqueId not in (select Don.DonorId from Donations Don where Don.ResultStatus != 5)",8
"select top(1) PerC.UniqueId Ent from ref.SystemSettings SysSet, PersonCards PerC join AppointedDonationTypes AppD on PerC.UniqueId = AppD.DonorId join (select AppD.DonorId, max(AppD.DonationDate) MaxDate from AppointedDonationTypes AppD group by AppD.DonorId) Main on AppD.DonorId = Main.DonorId and AppD.DonationDate = Main.MaxDate join ref.DonationTypeParams DonTP on AppD.DonationTypeId = DonTP.DonationTypeId join ref.DonationTypes DonT on AppD.DonationTypeId = DonT.UniqueId join Deferrals Def on PerC.UniqueId = Def.DonorId and cast(Def.StopDate as date) < cast(getdate() as date) join ref.DeferralTypes DefT on Def.DeferralTypeId = DefT.UniqueId and DefT.BaseType = 3 left join EpidControls Epid1 on PerC.RegAddressId = Epid1.PersonAddressId left join EpidControls Epid2 on PerC.FactAddressId = Epid2.PersonAddressId left join EpidControls Epid3 on PerC.TempAddressId = Epid3.PersonAddressId left join PersonMedicalNotes Nt on PerC.UniqueId = Nt.DonorId where PerC.IsDeleted != 1 and cast(PerC.BirthDate as date) > cast(dateadd(year, -SysSet.DonorMaxAge, getdate()) as date) and cast(PerC.BirthDate as date) < cast(dateadd(year, -SysSet.DonorMinAge, getdate()) as date) and PerC.BirthDateIsUndefined = 0 and PerC.DeathDate is null and PerC.UniqueId not in (select PrReg.DonorId from DonationProcessRegistry PrReg where PrReg.RegDate = cast(getdate() as date) and PrReg.CurrentState != 6) and PerC.UniqueId not in (select Don.DonorId from Donations Don where cast(Don.DonationDate as date) = cast(getdate() as date)) and PerC.UniqueId not in (select Def.DonorId from Deferrals Def join ref.DeferralTypes DefT on Def.DeferralTypeId = DefT.UniqueId where ((DefT.BaseType in (1, 2) and Def.RevokeDate is null) or (DefT.BaseType = 3 and (cast(Def.StopDate as date) >= cast(getdate() as date) or Def.StopDate is null)))) and PerC.UniqueId not in (select MaxDon.DonorId from Donations Don join (select Don.DonorId, max(Don.DonationDate) MaxDate from Donations Don, ref.SystemSettings SysSet where Don.OrgId = SysSet.CurrentOrganizationId group by Don.DonorId) MaxDon on Don.DonorId = MaxDon.DonorId and Don.DonationDate != MaxDon.MaxDate join DonationTestResults DonTest on Don.UniqueId = DonTest.DonationId where DonTest.TestTypeId = 42 and DonTest.TestValue = 13) and PerC.Gender in (1,2) and PerC.IdentityDocId is not null and ((PerC.RegAddressId is not null and (PerC.RegAddressIsInactive = 0 or PerC.RegAddressIsInactive is null)) or (PerC.FactAddressId is not null and (PerC.FactAddressIsInactive = 0 or PerC.FactAddressIsInactive is null)) or (PerC.TempAddressId is not null and (PerC.TempAddressIsInactive = 0 or PerC.TempAddressIsInactive is null))) and Epid1.Id is null and Epid2.Id is null and Epid3.Id is null and DonTP.IsActive = 1 and DonT.DonationParams not in (4, 5, 6, 7, 12, 15) and (cast(AppD.NextDonationDate as date) <= cast(getdate() as date) or AppD.NextDonationDate is null) and (Nt.AssignedTo not in (1, 3, 5, 7, 17, 19, 21, 23) or (Nt.IsFixed != 1 and cast(Nt.CreateDate as date) != cast(getdate() as date)) or Nt.UniqueId is null) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType = 2) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType in (3, 4) and MedTT.BloodTestCategory != 10) and DonT.ChargeType not in (0, 3) and PerC.UniqueId not in (select Don.DonorId from Donations Don where Don.ResultStatus != 5)",9
"select top(1) PerC.UniqueId Ent from ref.SystemSettings SysSet, PersonCards PerC join AppointedDonationTypes AppD on PerC.UniqueId = AppD.DonorId join (select AppD.DonorId, max(AppD.DonationDate) MaxDate from AppointedDonationTypes AppD group by AppD.DonorId) Main on AppD.DonorId = Main.DonorId and AppD.DonationDate = Main.MaxDate join ref.DonationTypeParams DonTP on AppD.DonationTypeId = DonTP.DonationTypeId join ref.DonationTypes DonT on AppD.DonationTypeId = DonT.UniqueId left join EpidControls Epid1 on PerC.RegAddressId = Epid1.PersonAddressId left join EpidControls Epid2 on PerC.FactAddressId = Epid2.PersonAddressId left join EpidControls Epid3 on PerC.TempAddressId = Epid3.PersonAddressId left join PersonMedicalNotes Nt on PerC.UniqueId = Nt.DonorId where PerC.IsDeleted != 1 and cast(PerC.BirthDate as date) > cast(dateadd(year, -SysSet.DonorMaxAge, getdate()) as date) and cast(PerC.BirthDate as date) < cast(dateadd(year, -SysSet.DonorMinAge, getdate()) as date) and PerC.BirthDateIsUndefined = 0 and PerC.DeathDate is null and PerC.UniqueId not in (select PrReg.DonorId from DonationProcessRegistry PrReg where PrReg.RegDate = cast(getdate() as date) and PrReg.CurrentState != 6) and PerC.UniqueId not in (select Don.DonorId from Donations Don where cast(Don.DonationDate as date) = cast(getdate() as date)) and PerC.UniqueId not in (select Def.DonorId from Deferrals Def join ref.DeferralTypes DefT on Def.DeferralTypeId = DefT.UniqueId where ((DefT.BaseType in (1, 2) and Def.RevokeDate is null) or (DefT.BaseType = 3 and (cast(Def.StopDate as date) >= cast(getdate() as date) or Def.StopDate is null)))) and PerC.UniqueId not in (select MaxDon.DonorId from Donations Don join (select Don.DonorId, max(Don.DonationDate) MaxDate from Donations Don, ref.SystemSettings SysSet where Don.OrgId = SysSet.CurrentOrganizationId group by Don.DonorId) MaxDon on Don.DonorId = MaxDon.DonorId and Don.DonationDate != MaxDon.MaxDate join DonationTestResults DonTest on Don.UniqueId = DonTest.DonationId where DonTest.TestTypeId = 42 and DonTest.TestValue = 13) and PerC.Gender in (1, 2) and PerC.IdentityDocId is not null and ((PerC.RegAddressId is not null and (PerC.RegAddressIsInactive = 0 or PerC.RegAddressIsInactive is null)) or (PerC.FactAddressId is not null and (PerC.FactAddressIsInactive = 0 or PerC.FactAddressIsInactive is null)) or (PerC.TempAddressId is not null and (PerC.TempAddressIsInactive = 0 or PerC.TempAddressIsInactive is null))) and ((Epid1.PersonAddressId is null and (PerC.RegAddressIsInactive = 0 or PerC.RegAddressIsInactive is null)) or PerC.RegAddressId is null or (Epid1.PersonAddressId is not null and PerC.RegAddressIsInactive = 1)) and ((Epid2.PersonAddressId is null and (PerC.FactAddressIsInactive = 0 or PerC.FactAddressIsInactive is null)) or PerC.FactAddressId is null or (Epid2.PersonAddressId is not null and PerC.FactAddressIsInactive = 1)) and ((Epid3.PersonAddressId is null and (PerC.TempAddressIsInactive = 0 or PerC.TempAddressIsInactive is null)) or PerC.TempAddressId is null or (Epid3.PersonAddressId is not null and PerC.TempAddressIsInactive = 1)) and ((Epid1.PersonAddressId is not null and PerC.RegAddressIsInactive = 1) or (Epid2.PersonAddressId is not null and PerC.FactAddressIsInactive = 1) or (Epid3.PersonAddressId is not null and PerC.TempAddressIsInactive = 1)) and DonTP.IsActive = 1 and DonT.DonationParams not in (4, 5, 6, 7, 12, 15) and (cast(AppD.NextDonationDate as date) <= cast(getdate() as date) or AppD.NextDonationDate is null) and (Nt.AssignedTo not in (1, 3, 5, 7, 17, 19, 21, 23) or (Nt.IsFixed != 1 and cast(Nt.CreateDate as date) != cast(getdate() as date)) or Nt.UniqueId is null) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType = 2) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType in (3, 4) and MedTT.BloodTestCategory != 10) and DonT.ChargeType not in (0, 3) and PerC.UniqueId not in (select Don.DonorId from Donations Don where Don.ResultStatus != 5)",10
"select top(1) PerC.UniqueId Ent from ref.SystemSettings SysSet, PersonCards PerC join AppointedDonationTypes AppD on PerC.UniqueId = AppD.DonorId join (select AppD.DonorId, max(AppD.DonationDate) MaxDate from AppointedDonationTypes AppD group by AppD.DonorId) Main on AppD.DonorId = Main.DonorId and AppD.DonationDate = Main.MaxDate join ref.DonationTypeParams DonTP on AppD.DonationTypeId = DonTP.DonationTypeId join ref.DonationTypes DonT on AppD.DonationTypeId = DonT.UniqueId join PersonAddresses PerAdd on PerC.RegAddressId = PerAdd.UniqueId left join EpidControls Epid1 on PerC.RegAddressId = Epid1.PersonAddressId left join EpidControls Epid2 on PerC.FactAddressId = Epid2.PersonAddressId left join EpidControls Epid3 on PerC.TempAddressId = Epid3.PersonAddressId left join PersonMedicalNotes Nt on PerC.UniqueId = Nt.DonorId where PerC.IsDeleted != 1 and cast(PerC.BirthDate as date) > cast(dateadd(year, -SysSet.DonorMaxAge, getdate()) as date) and cast(PerC.BirthDate as date) < cast(dateadd(year, -SysSet.DonorMinAge, getdate()) as date) and PerC.BirthDateIsUndefined = 0 and PerC.DeathDate is null and PerC.UniqueId not in (select PrReg.DonorId from DonationProcessRegistry PrReg where PrReg.RegDate = cast(getdate() as date) and PrReg.CurrentState != 6) and PerC.UniqueId not in (select Don.DonorId from Donations Don where cast(Don.DonationDate as date) = cast(getdate() as date)) and PerC.UniqueId not in (select Def.DonorId from Deferrals Def join ref.DeferralTypes DefT on Def.DeferralTypeId = DefT.UniqueId where ((DefT.BaseType in (1, 2) and Def.RevokeDate is null) or (DefT.BaseType = 3 and (cast(Def.StopDate as date) >= cast(getdate() as date) or Def.StopDate is null)))) and PerC.UniqueId not in (select MaxDon.DonorId from Donations Don join (select Don.DonorId, max(Don.DonationDate) MaxDate from Donations Don, ref.SystemSettings SysSet where Don.OrgId = SysSet.CurrentOrganizationId group by Don.DonorId) MaxDon on Don.DonorId = MaxDon.DonorId and Don.DonationDate != MaxDon.MaxDate join DonationTestResults DonTest on Don.UniqueId = DonTest.DonationId where DonTest.TestTypeId = 42 and DonTest.TestValue = 13) and PerC.Gender in (1, 2) and PerC.IdentityDocId is not null and PerAdd.FiasRegion is null and (PerC.RegAddressIsInactive = 0 or PerC.RegAddressIsInactive is null) and (PerC.FactAddressId is null or PerC.FactAddressIsInactive = 1) and (PerC.TempAddressId is null or PerC.TempAddressIsInactive = 1) and (Epid3.Id is null or PerC.TempAddressId is null) and Epid1.Id is null and Epid2.Id is null and Epid3.Id is null and DonTP.IsActive = 1 and DonT.DonationParams not in (4, 5, 6, 7, 12, 15) and (cast(AppD.NextDonationDate as date) <= cast(getdate() as date) or AppD.NextDonationDate is null) and (Nt.AssignedTo not in (1, 3, 5, 7, 17, 19, 21, 23) or (Nt.IsFixed != 1 and cast(Nt.CreateDate as date) != cast(getdate() as date)) or Nt.UniqueId is null) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType = 2) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType in (3, 4) and MedTT.BloodTestCategory != 10) and DonT.ChargeType not in (0, 3) and PerC.UniqueId not in (select Don.DonorId from Donations Don where Don.ResultStatus != 5)",11
"select top(1) PerC.UniqueId Ent from ref.SystemSettings SysSet, PersonCards PerC join AppointedDonationTypes AppD on PerC.UniqueId = AppD.DonorId join (select AppD.DonorId, max(AppD.DonationDate) MaxDate from AppointedDonationTypes AppD group by AppD.DonorId) Main on AppD.DonorId = Main.DonorId and AppD.DonationDate = Main.MaxDate join ref.DonationTypeParams DonTP on AppD.DonationTypeId = DonTP.DonationTypeId join ref.DonationTypes DonT on AppD.DonationTypeId = DonT.UniqueId join PersonMedicalNotes Nt on PerC.UniqueId = Nt.DonorId join PersonMedicalNotes Nt2 on PerC.UniqueId = Nt2.DonorId left join EpidControls Epid1 on PerC.RegAddressId = Epid1.PersonAddressId left join EpidControls Epid2 on PerC.FactAddressId = Epid2.PersonAddressId left join EpidControls Epid3 on PerC.TempAddressId = Epid3.PersonAddressId where PerC.IsDeleted != 1 and cast(PerC.BirthDate as date) > cast(dateadd(year, -SysSet.DonorMaxAge, getdate()) as date) and cast(PerC.BirthDate as date) < cast(dateadd(year, -SysSet.DonorMinAge, getdate()) as date) and PerC.BirthDateIsUndefined = 0 and PerC.DeathDate is null and PerC.UniqueId not in (select PrReg.DonorId from DonationProcessRegistry PrReg where PrReg.RegDate = cast(getdate() as date) and PrReg.CurrentState != 6) and PerC.UniqueId not in (select Don.DonorId from Donations Don where cast(Don.DonationDate as date) = cast(getdate() as date)) and PerC.UniqueId not in (select Def.DonorId from Deferrals Def join ref.DeferralTypes DefT on Def.DeferralTypeId = DefT.UniqueId where ((DefT.BaseType in (1, 2) and Def.RevokeDate is null) or (DefT.BaseType = 3 and (cast(Def.StopDate as date) >= cast(getdate() as date) or Def.StopDate is null)))) and PerC.UniqueId not in (select MaxDon.DonorId from Donations Don join (select Don.DonorId, max(Don.DonationDate) MaxDate from Donations Don, ref.SystemSettings SysSet where Don.OrgId = SysSet.CurrentOrganizationId group by Don.DonorId) MaxDon on Don.DonorId = MaxDon.DonorId and Don.DonationDate != MaxDon.MaxDate join DonationTestResults DonTest on Don.UniqueId = DonTest.DonationId where DonTest.TestTypeId = 42 and DonTest.TestValue = 13) and PerC.Gender in (1, 2) and PerC.IdentityDocId is not null and ((PerC.RegAddressId is not null and (PerC.RegAddressIsInactive = 0 or PerC.RegAddressIsInactive is null)) or (PerC.FactAddressId is not null and (PerC.FactAddressIsInactive = 0 or PerC.FactAddressIsInactive is null)) or (PerC.TempAddressId is not null and (PerC.TempAddressIsInactive = 0 or PerC.TempAddressIsInactive is null))) and Epid1.Id is null and Epid2.Id is null and Epid3.Id is null and DonTP.IsActive = 1 and DonT.DonationParams not in (4, 5, 6, 7, 12, 15) and (cast(AppD.NextDonationDate as date) <= cast(getdate() as date) or AppD.NextDonationDate is null) and (Nt.AssignedTo not in (1, 3, 5, 7, 17, 19, 21, 23) or ((Nt.AssignedTo in (1, 3, 5, 7, 17, 19, 21, 23) and Nt.IsFixed != 1) or (Nt.AssignedTo in (1, 3, 5, 7, 17, 19, 21, 23) and cast(Nt.CreateDate as date) != cast(getdate() as date))) and (Nt2.AssignedTo in (1, 3, 5, 7, 17, 19, 21, 23) and Nt2.IsFixed != 1 and cast(Nt.CreateDate as date) != cast(getdate() as date))) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType = 2) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType in (3, 4) and MedTT.BloodTestCategory != 10) and DonT.ChargeType not in (0, 3) and PerC.UniqueId not in (select Don.DonorId from Donations Don where Don.ResultStatus != 5)",12
"select top(1) PerC.UniqueId Ent from ref.SystemSettings SysSet, PersonCards PerC join AppointedDonationTypes AppD on PerC.UniqueId = AppD.DonorId join (select AppD.DonorId, max(AppD.DonationDate) MaxDate from AppointedDonationTypes AppD group by AppD.DonorId) Main on AppD.DonorId = Main.DonorId and AppD.DonationDate = Main.MaxDate join ref.DonationTypeParams DonTP on AppD.DonationTypeId = DonTP.DonationTypeId join ref.DonationTypes DonT on AppD.DonationTypeId = DonT.UniqueId join PersonMedicalNotes Nt on PerC.UniqueId = Nt.DonorId join PersonMedicalNotes Nt2 on PerC.UniqueId = Nt2.DonorId left join EpidControls Epid1 on PerC.RegAddressId = Epid1.PersonAddressId left join EpidControls Epid2 on PerC.FactAddressId = Epid2.PersonAddressId left join EpidControls Epid3 on PerC.TempAddressId = Epid3.PersonAddressId where PerC.IsDeleted != 1 and cast(PerC.BirthDate as date) > cast(dateadd(year, -SysSet.DonorMaxAge, getdate()) as date) and cast(PerC.BirthDate as date) < cast(dateadd(year, -SysSet.DonorMinAge, getdate()) as date) and PerC.BirthDateIsUndefined = 0 and PerC.DeathDate is null and PerC.UniqueId not in (select PrReg.DonorId from DonationProcessRegistry PrReg where PrReg.RegDate = cast(getdate() as date) and PrReg.CurrentState != 6) and PerC.UniqueId not in (select Don.DonorId from Donations Don where cast(Don.DonationDate as date) = cast(getdate() as date)) and PerC.UniqueId not in (select Def.DonorId from Deferrals Def join ref.DeferralTypes DefT on Def.DeferralTypeId = DefT.UniqueId where ((DefT.BaseType in (1, 2) and Def.RevokeDate is null) or (DefT.BaseType = 3 and (cast(Def.StopDate as date) >= cast(getdate() as date) or Def.StopDate is null)))) and PerC.UniqueId not in (select MaxDon.DonorId from Donations Don join (select Don.DonorId, max(Don.DonationDate) MaxDate from Donations Don, ref.SystemSettings SysSet where Don.OrgId = SysSet.CurrentOrganizationId group by Don.DonorId) MaxDon on Don.DonorId = MaxDon.DonorId and Don.DonationDate != MaxDon.MaxDate join DonationTestResults DonTest on Don.UniqueId = DonTest.DonationId where DonTest.TestTypeId = 42 and DonTest.TestValue = 13) and PerC.Gender in (1, 2) and PerC.IdentityDocId is not null and ((PerC.RegAddressId is not null and (PerC.RegAddressIsInactive = 0 or PerC.RegAddressIsInactive is null)) or (PerC.FactAddressId is not null and (PerC.FactAddressIsInactive = 0 or PerC.FactAddressIsInactive is null)) or (PerC.TempAddressId is not null and (PerC.TempAddressIsInactive = 0 or PerC.TempAddressIsInactive is null))) and Epid1.Id is null and Epid2.Id is null and Epid3.Id is null and DonTP.IsActive = 1 and DonT.DonationParams not in (4, 5, 6, 7, 12, 15) and (cast(AppD.NextDonationDate as date) <= cast(getdate() as date) or AppD.NextDonationDate is null) and (Nt.AssignedTo not in (1, 3, 5, 7, 17, 19, 21, 23) or ((Nt.AssignedTo in (1, 3, 5, 7, 17, 19, 21, 23) and Nt.IsFixed != 1) or (Nt.AssignedTo in (1, 3, 5, 7, 17, 19, 21, 23) and cast(Nt.CreateDate as date) != cast(getdate() as date)))) and (Nt2.AssignedTo not in (1, 3, 5, 7, 17, 19, 21, 23) and cast(Nt.CreateDate as date) = cast(getdate() as date) and Nt2.IsDeleted != 1) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType = 2) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id 	and MedTT.ExamType in (3, 4) and MedTT.BloodTestCategory != 10) and DonT.ChargeType not in (0, 3) and PerC.UniqueId not in (select Don.DonorId from Donations Don where Don.ResultStatus != 5)",13
"select top(1) PerC.UniqueId Ent from ref.SystemSettings SysSet, PersonCards PerC join AppointedDonationTypes AppD on PerC.UniqueId = AppD.DonorId join (select AppD.DonorId, max(AppD.DonationDate) MaxDate from AppointedDonationTypes AppD group by AppD.DonorId) Main on AppD.DonorId = Main.DonorId and AppD.DonationDate = Main.MaxDate join ref.DonationTypeParams DonTP on AppD.DonationTypeId = DonTP.DonationTypeId join ref.DonationTypes DonT on AppD.DonationTypeId = DonT.UniqueId left join EpidControls Epid1 on PerC.RegAddressId = Epid1.PersonAddressId left join EpidControls Epid2 on PerC.FactAddressId = Epid2.PersonAddressId left join EpidControls Epid3 on PerC.TempAddressId = Epid3.PersonAddressId where PerC.IsDeleted != 1 and cast(PerC.BirthDate as date) > cast(dateadd(year, -SysSet.DonorMaxAge, getdate()) as date) and cast(PerC.BirthDate as date) < cast(dateadd(year, -SysSet.DonorMinAge, getdate()) as date) and PerC.BirthDateIsUndefined = 0 and PerC.DeathDate is null and PerC.UniqueId not in (select PrReg.DonorId from DonationProcessRegistry PrReg where PrReg.RegDate = cast(getdate() as date) and PrReg.CurrentState != 6) and PerC.UniqueId not in (select Don.DonorId from Donations Don where cast(Don.DonationDate as date) = cast(getdate() as date)) and PerC.UniqueId not in (select Def.DonorId from Deferrals Def join ref.DeferralTypes DefT on Def.DeferralTypeId = DefT.UniqueId where ((DefT.BaseType in (1, 2) and Def.RevokeDate is null) or (DefT.BaseType = 3 and (cast(Def.StopDate as date) >= cast(getdate() as date) or Def.StopDate is null)))) and PerC.UniqueId not in (select MaxDon.DonorId from Donations Don join (select Don.DonorId, max(Don.DonationDate) MaxDate from Donations Don, ref.SystemSettings SysSet where Don.OrgId = SysSet.CurrentOrganizationId group by Don.DonorId) MaxDon on Don.DonorId = MaxDon.DonorId and Don.DonationDate != MaxDon.MaxDate join DonationTestResults DonTest on Don.UniqueId = DonTest.DonationId where DonTest.TestTypeId = 42 and DonTest.TestValue = 13) and PerC.Gender in (1, 2) and PerC.IdentityDocId is not null and ((PerC.RegAddressId is not null and (PerC.RegAddressIsInactive = 0 or PerC.RegAddressIsInactive is null)) or (PerC.FactAddressId is not null and (PerC.FactAddressIsInactive = 0 or PerC.FactAddressIsInactive is null)) or (PerC.TempAddressId is not null and (PerC.TempAddressIsInactive = 0 or PerC.TempAddressIsInactive is null))) and Epid1.Id is null and Epid2.Id is null and Epid3.Id is null and DonTP.IsActive = 1 and DonT.DonationParams not in (4, 5, 6, 7, 12, 15) and (cast(AppD.NextDonationDate as date) <= cast(getdate() as date) or AppD.NextDonationDate is null) and PerC.UniqueId not in (select Nt.DonorId from PersonMedicalNotes NT where Nt.AssignedTo in (1, 3, 5, 7, 17, 19, 21, 23) and Nt.IsDeleted != 1 and (Nt.IsFixed = 1 or cast(Nt.CreateDate as date) = cast(getdate() as date))) and PerC.UniqueId in (select Nt.DonorId from PersonMedicalNotes NT where Nt.IsFixed = 1 and Nt.IsDeleted != 1) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType = 2) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType in (3, 4) and MedTT.BloodTestCategory != 10) and DonT.ChargeType not in (0, 3) and PerC.UniqueId not in (select Don.DonorId from Donations Don where Don.ResultStatus != 5)",14
"select top(1) PerC.UniqueId Ent from ref.SystemSettings SysSet, PersonCards PerC join AppointedDonationTypes AppD on PerC.UniqueId = AppD.DonorId join (select AppD.DonorId, max(AppD.DonationDate) MaxDate from AppointedDonationTypes AppD group by AppD.DonorId) Main on AppD.DonorId = Main.DonorId and AppD.DonationDate = Main.MaxDate join ref.DonationTypeParams DonTP on AppD.DonationTypeId = DonTP.DonationTypeId join ref.DonationTypes DonT on AppD.DonationTypeId = DonT.UniqueId join PersonMedicalNotes Nt on PerC.UniqueId = Nt.DonorId join PersonMedicalNotes Nt2 on PerC.UniqueId = Nt2.DonorId left join EpidControls Epid1 on PerC.RegAddressId = Epid1.PersonAddressId left join EpidControls Epid2 on PerC.FactAddressId = Epid2.PersonAddressId left join EpidControls Epid3 on PerC.TempAddressId = Epid3.PersonAddressId where PerC.IsDeleted != 1 and cast(PerC.BirthDate as date) > cast(dateadd(year, -SysSet.DonorMaxAge, getdate()) as date) and cast(PerC.BirthDate as date) < cast(dateadd(year, -SysSet.DonorMinAge, getdate()) as date) and PerC.BirthDateIsUndefined = 0 and PerC.DeathDate is null and PerC.UniqueId not in (select PrReg.DonorId from DonationProcessRegistry PrReg where PrReg.RegDate = cast(getdate() as date) and PrReg.CurrentState != 6) and PerC.UniqueId not in (select Don.DonorId from Donations Don where cast(Don.DonationDate as date) = cast(getdate() as date)) and PerC.UniqueId not in (select Def.DonorId from Deferrals Def join ref.DeferralTypes DefT on Def.DeferralTypeId = DefT.UniqueId where ((DefT.BaseType in (1, 2) and Def.RevokeDate is null) or (DefT.BaseType = 3 and (cast(Def.StopDate as date) >= cast(getdate() as date) or Def.StopDate is null)))) and PerC.UniqueId not in (select MaxDon.DonorId from Donations Don join (select Don.DonorId, max(Don.DonationDate) MaxDate from Donations Don, ref.SystemSettings SysSet where Don.OrgId = SysSet.CurrentOrganizationId group by Don.DonorId) MaxDon on Don.DonorId = MaxDon.DonorId and Don.DonationDate != MaxDon.MaxDate join DonationTestResults DonTest on Don.UniqueId = DonTest.DonationId where DonTest.TestTypeId = 42 and DonTest.TestValue = 13) and PerC.Gender in (1, 2) and PerC.IdentityDocId is not null and ((PerC.RegAddressId is not null and (PerC.RegAddressIsInactive = 0 or PerC.RegAddressIsInactive is null)) or (PerC.FactAddressId is not null and (PerC.FactAddressIsInactive = 0 or PerC.FactAddressIsInactive is null)) or (PerC.TempAddressId is not null and (PerC.TempAddressIsInactive = 0 or PerC.TempAddressIsInactive is null))) and Epid1.Id is null and Epid2.Id is null and Epid3.Id is null and DonTP.IsActive = 1 and DonT.DonationParams not in (4, 5, 6, 7, 12, 15) and (cast(AppD.NextDonationDate as date) <= cast(getdate() as date) or AppD.NextDonationDate is null) and (Nt.AssignedTo not in (1, 3, 5, 7, 17, 19, 21, 23) or ((Nt.AssignedTo in (1, 3, 5, 7, 17, 19, 21, 23) and Nt.IsFixed != 1) or (Nt.AssignedTo in (1, 3, 5, 7, 17, 19, 21, 23) and cast(Nt.CreateDate as date) != cast(getdate() as date)))) and (Nt2.AssignedTo in (1, 3, 5, 7, 17, 19, 21, 23) and (Nt2.IsFixed = 1 or cast(Nt.CreateDate as date) = cast(getdate() as date)) and Nt2.IsDeleted = 1) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType = 2) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType in (3, 4) and MedTT.BloodTestCategory != 10) and DonT.ChargeType not in (0, 3) and PerC.UniqueId not in (select Don.DonorId from Donations Don where Don.ResultStatus != 5)",15
"select top(1) PerC.UniqueId Ent from ref.SystemSettings SysSet, PersonCards PerC join AppointedDonationTypes AppD on PerC.UniqueId = AppD.DonorId join (select AppD.DonorId, max(AppD.DonationDate) MaxDate from AppointedDonationTypes AppD group by AppD.DonorId) Main on AppD.DonorId = Main.DonorId and AppD.DonationDate = Main.MaxDate join ref.DonationTypeParams DonTP on AppD.DonationTypeId = DonTP.DonationTypeId join ref.DonationTypes DonT on AppD.DonationTypeId = DonT.UniqueId join Donations Don on PerC.UniqueId = Don.DonorId left join PersonMedicalNotes Nt on PerC.UniqueId = Nt.DonorId left join EpidControls Epid1 on PerC.RegAddressId = Epid1.PersonAddressId left join EpidControls Epid2 on PerC.FactAddressId = Epid2.PersonAddressId left join EpidControls Epid3 on PerC.TempAddressId = Epid3.PersonAddressId where PerC.IsDeleted != 1 and cast(PerC.BirthDate as date) > cast(dateadd(year, -SysSet.DonorMaxAge, getdate()) as date) and cast(PerC.BirthDate as date) < cast(dateadd(year, -SysSet.DonorMinAge, getdate()) as date) and PerC.BirthDateIsUndefined = 0 and PerC.DeathDate is null and PerC.UniqueId not in (select PrReg.DonorId from DonationProcessRegistry PrReg where PrReg.RegDate = cast(getdate() as date) and PrReg.CurrentState != 6) and PerC.UniqueId not in (select Don.DonorId from Donations Don where cast(Don.DonationDate as date) = cast(getdate() as date)) and PerC.UniqueId not in (select Def.DonorId from Deferrals Def join ref.DeferralTypes DefT on Def.DeferralTypeId = DefT.UniqueId where ((DefT.BaseType in (1, 2) and Def.RevokeDate is null) or (DefT.BaseType = 3 and (cast(Def.StopDate as date) >= cast(getdate() as date) or Def.StopDate is null)))) and PerC.UniqueId not in (select MaxDon.DonorId from Donations Don join (select Don.DonorId, max(Don.DonationDate) MaxDate from Donations Don, ref.SystemSettings SysSet where Don.OrgId = SysSet.CurrentOrganizationId group by Don.DonorId) MaxDon on Don.DonorId = MaxDon.DonorId and Don.DonationDate != MaxDon.MaxDate join DonationTestResults DonTest on Don.UniqueId = DonTest.DonationId where DonTest.TestTypeId = 42 and DonTest.TestValue = 13) and PerC.Gender in (1, 2) and PerC.IdentityDocId is not null and ((PerC.RegAddressId is not null and (PerC.RegAddressIsInactive = 0 or PerC.RegAddressIsInactive is null)) or (PerC.FactAddressId is not null and (PerC.FactAddressIsInactive = 0 or PerC.FactAddressIsInactive is null)) or (PerC.TempAddressId is not null and (PerC.TempAddressIsInactive = 0 or PerC.TempAddressIsInactive is null))) and Epid1.Id is null and Epid2.Id is null and Epid3.Id is null and DonTP.IsActive = 1 and DonT.DonationParams not in (4, 5, 6, 7, 12, 15) and (cast(AppD.NextDonationDate as date) <= cast(getdate() as date) or AppD.NextDonationDate is null) and (Nt.AssignedTo not in (1, 3, 5, 7, 17, 19, 21, 23) or ((Nt.AssignedTo in (1, 3, 5, 7, 17, 19, 21, 23) and Nt.IsFixed != 1) or (Nt.AssignedTo in (1, 3, 5, 7, 17, 19, 21, 23) and cast(Nt.CreateDate as date) != cast(getdate() as date)))) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType = 2) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType in (3, 4) and MedTT.BloodTestCategory != 10) and DonT.ChargeType not in (0, 3) and Don.ResultStatus != 5",16
"select top(1) PerC.UniqueId Ent from ref.SystemSettings SysSet, PersonCards PerC join AppointedDonationTypes AppD on PerC.UniqueId = AppD.DonorId join (select AppD.DonorId, max(AppD.DonationDate) MaxDate from AppointedDonationTypes AppD group by AppD.DonorId) Main on AppD.DonorId = Main.DonorId and AppD.DonationDate = Main.MaxDate join ref.DonationTypeParams DonTP on AppD.DonationTypeId = DonTP.DonationTypeId join ref.DonationTypes DonT on AppD.DonationTypeId = DonT.UniqueId join (select Don.DonorId, count(Don.UniqueId) Q from  Donations Don join ref.DonationTypes DonT on Don.DonationTypeId = DonT.UniqueId where DonT.ComponentType in (1, 3, 4, 5) and Don.IsDeleted = 0 and Don.UniqueId not in (select DonCom.DonationId from DonationComplications DonCom join ref.DonationComplicationTypes DonComT on DonCom.ComplicationTypeGuid = DonComT.Guid where DonComT.CalculateDonation = 0) and DonT.ChargeType = 1 group by Don.DonorId) Bl on PerC.UniqueId = Bl.DonorId join (select Don.DonorId, count(Don.UniqueId) Q from Donations Don join ref.DonationTypes DonT on Don.DonationTypeId = DonT.UniqueId where DonT.ComponentType = 2 and Don.IsDeleted = 0 and Don.UniqueId not in (select DonCom.DonationId from DonationComplications DonCom join ref.DonationComplicationTypes DonComT on DonCom.ComplicationTypeGuid = DonComT.Guid where DonComT.CalculateDonation = 0) and DonT.ChargeType = 1 group by Don.DonorId) Pl on PerC.UniqueId = Pl.DonorId left join PersonMedicalNotes Nt on PerC.UniqueId = Nt.DonorId left join EpidControls Epid1 on PerC.RegAddressId = Epid1.PersonAddressId left join EpidControls Epid2 on PerC.FactAddressId = Epid2.PersonAddressId left join EpidControls Epid3 on PerC.TempAddressId = Epid3.PersonAddressId where PerC.IsDeleted != 1 and PerC.UniqueId not in (select  HonD.DonorId from HonorableDonors HonD) and cast(PerC.BirthDate as date) > cast(dateadd(year, -SysSet.DonorMaxAge, getdate()) as date) and cast(PerC.BirthDate as date) < cast(dateadd(year, -SysSet.DonorMinAge, getdate()) as date) and PerC.BirthDateIsUndefined = 0 and PerC.DeathDate is null and PerC.UniqueId not in (select PrReg.DonorId from DonationProcessRegistry PrReg where PrReg.RegDate = cast(getdate() as date) and PrReg.CurrentState != 6) and PerC.UniqueId not in (select Don.DonorId from Donations Don where cast(Don.DonationDate as date) = cast(getdate() as date)) and PerC.UniqueId not in (select Def.DonorId from Deferrals Def join ref.DeferralTypes DefT on Def.DeferralTypeId = DefT.UniqueId where ((DefT.BaseType in (1, 2) and Def.RevokeDate is null) or (DefT.BaseType = 3 and (cast(Def.StopDate as date) >= cast(getdate() as date) or Def.StopDate is null)))) and PerC.UniqueId not in (select MaxDon.DonorId from Donations Don join (select Don.DonorId, max(Don.DonationDate) MaxDate from Donations Don, ref.SystemSettings SysSet where Don.OrgId = SysSet.CurrentOrganizationId group by Don.DonorId) MaxDon on Don.DonorId = MaxDon.DonorId and Don.DonationDate != MaxDon.MaxDate join DonationTestResults DonTest on Don.UniqueId = DonTest.DonationId where DonTest.TestTypeId = 42 and DonTest.TestValue = 13) and PerC.Gender in (1, 2) and PerC.IdentityDocId is not null and ((PerC.RegAddressId is not null and (PerC.RegAddressIsInactive = 0 or PerC.RegAddressIsInactive is null)) or (PerC.FactAddressId is not null and (PerC.FactAddressIsInactive = 0 or PerC.FactAddressIsInactive is null)) or (PerC.TempAddressId is not null and (PerC.TempAddressIsInactive = 0 or PerC.TempAddressIsInactive is null))) and Epid1.Id is null and Epid2.Id is null and Epid3.Id is null and DonTP.IsActive = 1 and DonT.DonationParams not in (4, 5, 6, 7, 12, 15) and (cast(AppD.NextDonationDate as date) <= cast(getdate() as date) or AppD.NextDonationDate is null) and (Nt.AssignedTo not in (1, 3, 5, 7, 17, 19, 21, 23) or ((Nt.AssignedTo in (1, 3, 5, 7, 17, 19, 21, 23) and Nt.IsFixed != 1) or (Nt.AssignedTo in (1, 3, 5, 7, 17, 19, 21, 23) and cast(Nt.CreateDate as date) != cast(getdate() as date))))and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType = 2) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType in (3, 4) and MedTT.BloodTestCategory != 10) and DonT.ChargeType not in (0, 3) and PerC.UniqueId not in (select Don.DonorId from Donations Don where Don.ResultStatus != 5) and Bl.Q > 5 and Pl.Q > 5",17