query, test_data_set_number
"select top(1) PerC.UniqueId Ent from ref.SystemSettings SysSet, PersonCards PerC join AppointedDonationTypes AppD on PerC.UniqueId = AppD.DonorId join (select AppD.DonorId, max(AppD.DonationDate) MaxDate from AppointedDonationTypes AppD group by AppD.DonorId) Main on AppD.DonorId = Main.DonorId and AppD.DonationDate = Main.MaxDate join ref.DonationTypeParams DonTP on AppD.DonationTypeId = DonTP.DonationTypeId join ref.DonationTypes DonT on AppD.DonationTypeId = DonT.UniqueId left join EpidControls Epid1 on PerC.RegAddressId = Epid1.PersonAddressId left join EpidControls Epid2 on PerC.FactAddressId = Epid2.PersonAddressId left join EpidControls Epid3 on PerC.TempAddressId = Epid3.PersonAddressId left join (select Don.DonorId, count(Don.UniqueId) Q from Donations Don join ref.DonationTypes DonT on Don.DonationTypeId = DonT.UniqueId where DonT.ComponentType = 1 and Don.IsDeleted = 0 and Don.UniqueId not in (select DonCom.DonationId from DonationComplications DonCom join ref.DonationComplicationTypes DonComT on DonCom.ComplicationTypeGuid = DonComT.Guid where DonComT.CalculateDonation = 0) and cast(Don.DonationDate as date) > dateadd(year, -1, cast(getdate() as date)) group by Don.DonorId) Com on PerC.UniqueId = Com.DonorId left join PersonMedicalNotes Nt on PerC.UniqueId = Nt.DonorId where PerC.IsDeleted != 1 and Com.Q < SysSet.MaxYearBloodDonationCountMale and cast(PerC.BirthDate as date) > cast(dateadd(year, -SysSet.DonorMaxAge, getdate()) as date) and cast(PerC.BirthDate as date) < cast(dateadd(year, -SysSet.DonorMinAge, getdate()) as date) and PerC.BirthDateIsUndefined = 0 and PerC.DeathDate is null and PerC.UniqueId not in (select PrReg.DonorId from DonationProcessRegistry PrReg where PrReg.RegDate = cast(getdate() as date) and PrReg.CurrentState != 6) and PerC.UniqueId not in (select Don.DonorId from Donations Don where cast(Don.DonationDate as date) = cast(getdate() as date)) and PerC.UniqueId not in (select Def.DonorId from Deferrals Def join ref.DeferralTypes DefT on Def.DeferralTypeId = DefT.UniqueId where ((DefT.BaseType in (1, 2) and Def.RevokeDate is null) or (DefT.BaseType = 3 and (cast(Def.StopDate as date) >= cast(getdate() as date) or Def.StopDate is null)))) and PerC.UniqueId not in (select MaxDon.DonorId from Donations Don join (select Don.DonorId, max(Don.DonationDate) MaxDate from Donations Don, ref.SystemSettings SysSet where Don.OrgId = SysSet.CurrentOrganizationId group by Don.DonorId) MaxDon on Don.DonorId = MaxDon.DonorId and Don.DonationDate != MaxDon.MaxDate join DonationTestResults DonTest on Don.UniqueId = DonTest.DonationId where DonTest.TestTypeId = 42 and DonTest.TestValue = 13) and PerC.Gender = 1 and PerC.IdentityDocId is not null and ((PerC.RegAddressId is not null and (PerC.RegAddressIsInactive = 0 or PerC.RegAddressIsInactive is null)) or (PerC.FactAddressId is not null and (PerC.FactAddressIsInactive = 0 or PerC.FactAddressIsInactive is null)) or (PerC.TempAddressId is not null and (PerC.TempAddressIsInactive = 0 or PerC.TempAddressIsInactive is null))) and Epid1.Id is null and Epid2.Id is null and Epid3.Id is null and DonTP.IsActive = 1 and DonT.DonationParams not in (4, 5, 6, 7, 12, 15) and (cast(AppD.NextDonationDate as date) <= cast(getdate() as date) or AppD.NextDonationDate is null) and (Nt.AssignedTo not in (1, 3, 5, 7, 17, 19, 21, 23) or (Nt.IsFixed != 1 and cast(Nt.CreateDate as date) != cast(getdate() as date)) or Nt.UniqueId is null) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType = 2) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType in (3, 4) and MedTT.BloodTestCategory != 10) and DonT.ChargeType not in (0, 3) and DonT.ComponentType = 1 and PerC.UniqueId not in (select Don.DonorId from Donations Don where Don.ResultStatus != 5)",18
"select top(1) PerC.UniqueId Ent from ref.SystemSettings SysSet, PersonCards PerC join AppointedDonationTypes AppD on PerC.UniqueId = AppD.DonorId join (select AppD.DonorId, max(AppD.DonationDate) MaxDate from AppointedDonationTypes AppD group by AppD.DonorId) Main on AppD.DonorId = Main.DonorId and AppD.DonationDate = Main.MaxDate join ref.DonationTypeParams DonTP on AppD.DonationTypeId = DonTP.DonationTypeId join ref.DonationTypes DonT on AppD.DonationTypeId = DonT.UniqueId left join EpidControls Epid1 on PerC.RegAddressId = Epid1.PersonAddressId left join EpidControls Epid2 on PerC.FactAddressId = Epid2.PersonAddressId left join EpidControls Epid3 on PerC.TempAddressId = Epid3.PersonAddressId left join (select Don.DonorId, count(Don.UniqueId) Q from Donations Don join ref.DonationTypes DonT on Don.DonationTypeId = DonT.UniqueId where DonT.ComponentType = 2 and Don.IsDeleted = 0 and Don.UniqueId not in (select DonCom.DonationId from DonationComplications DonCom join ref.DonationComplicationTypes DonComT on DonCom.ComplicationTypeGuid = DonComT.Guid where DonComT.CalculateDonation = 0) and cast(Don.DonationDate as date) > dateadd(year, -1, cast(getdate() as date)) group by Don.DonorId) Com2 on PerC.UniqueId = Com2.DonorId left join (select Don.DonorId, sum(Prod.Volume) Q from Donations Don join ref.DonationTypes DonT on Don.DonationTypeId = DonT.UniqueId join ProductComponents Prod on Don.UniqueId = Prod.DonationId where DonT.ComponentType = 2 and Don.IsDeleted = 0 and Don.UniqueId not in (select DonCom.DonationId from DonationComplications DonCom join ref.DonationComplicationTypes DonComT on DonCom.ComplicationTypeGuid = DonComT.Guid where DonComT.CalculateDonation = 0) and cast(Don.DonationDate as date) > dateadd(year, -1, cast(getdate() as date)) group by Don.DonorId) Com4 on PerC.UniqueId = Com4.DonorId left join PersonMedicalNotes Nt on PerC.UniqueId = Nt.DonorId where PerC.IsDeleted != 1 and Com2.Q < SysSet.MaxYearPlasmapheresisCount and (Com4.Q + DonTP.StdDose < SysSet.MaxYearPlasmaVolumeMale * 1000 or Com4.Q is null) and cast(PerC.BirthDate as date) > cast(dateadd(year, -SysSet.DonorMaxAge, getdate()) as date) and cast(PerC.BirthDate as date) < cast(dateadd(year, -SysSet.DonorMinAge, getdate()) as date) and PerC.BirthDateIsUndefined = 0 and PerC.DeathDate is null and PerC.UniqueId not in (select PrReg.DonorId from DonationProcessRegistry PrReg where PrReg.RegDate = cast(getdate() as date) and PrReg.CurrentState != 6) and PerC.UniqueId not in (select Don.DonorId from Donations Don where cast(Don.DonationDate as date) = cast(getdate() as date)) and PerC.UniqueId not in (select Def.DonorId from Deferrals Def join ref.DeferralTypes DefT on Def.DeferralTypeId = DefT.UniqueId where ((DefT.BaseType in (1, 2) and Def.RevokeDate is null) or (DefT.BaseType = 3 and (cast(Def.StopDate as date) >= cast(getdate() as date) or Def.StopDate is null)))) and PerC.UniqueId not in (select MaxDon.DonorId from Donations Don join (select Don.DonorId, max(Don.DonationDate) MaxDate from Donations Don, ref.SystemSettings SysSet where Don.OrgId = SysSet.CurrentOrganizationId group by Don.DonorId) MaxDon on Don.DonorId = MaxDon.DonorId and Don.DonationDate != MaxDon.MaxDate join DonationTestResults DonTest on Don.UniqueId = DonTest.DonationId where DonTest.TestTypeId = 42 and DonTest.TestValue = 13) and PerC.Gender in (1,2) and PerC.IdentityDocId is not null and ((PerC.RegAddressId is not null and (PerC.RegAddressIsInactive = 0 or PerC.RegAddressIsInactive is null)) or (PerC.FactAddressId is not null and (PerC.FactAddressIsInactive = 0 or PerC.FactAddressIsInactive is null)) or (PerC.TempAddressId is not null and (PerC.TempAddressIsInactive = 0 or PerC.TempAddressIsInactive is null))) and Epid1.Id is null and Epid2.Id is null and Epid3.Id is null and DonTP.IsActive = 1 and DonT.DonationParams not in (4, 5, 6, 7, 12, 15) and (cast(AppD.NextDonationDate as date) <= cast(getdate() as date) or AppD.NextDonationDate is null) and (Nt.AssignedTo not in (1, 3, 5, 7, 17, 19, 21, 23) or (Nt.IsFixed != 1 and cast(Nt.CreateDate as date) != cast(getdate() as date)) or Nt.UniqueId is null) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType = 2) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType in (3, 4) and MedTT.BloodTestCategory != 10) and DonT.ChargeType not in (0, 3) and DonT.ComponentType = 2 and PerC.UniqueId not in (select Don.DonorId from Donations Don where Don.ResultStatus != 5)",19
"select top(1) PerC.UniqueId Ent from ref.SystemSettings SysSet, PersonCards PerC join AppointedDonationTypes AppD on PerC.UniqueId = AppD.DonorId join (select AppD.DonorId, max(AppD.DonationDate) MaxDate from AppointedDonationTypes AppD group by AppD.DonorId) Main on AppD.DonorId = Main.DonorId and AppD.DonationDate = Main.MaxDate join ref.DonationTypeParams DonTP on AppD.DonationTypeId = DonTP.DonationTypeId join ref.DonationTypes DonT on AppD.DonationTypeId = DonT.UniqueId left join EpidControls Epid1 on PerC.RegAddressId = Epid1.PersonAddressId left join EpidControls Epid2 on PerC.FactAddressId = Epid2.PersonAddressId left join EpidControls Epid3 on PerC.TempAddressId = Epid3.PersonAddressId left join (select Don.DonorId, count(Don.UniqueId) Q from Donations Don join ref.DonationTypes DonT on Don.DonationTypeId = DonT.UniqueId where DonT.ComponentType in (3, 4, 5) and Don.IsDeleted = 0 and Don.UniqueId not in (select DonCom.DonationId from DonationComplications DonCom join ref.DonationComplicationTypes DonComT on DonCom.ComplicationTypeGuid = DonComT.Guid where DonComT.CalculateDonation = 0) and cast(Don.DonationDate as date) > dateadd(year, -1, cast(getdate() as date)) group by Don.DonorId) Com3 on PerC.UniqueId = Com3.DonorId left join PersonMedicalNotes Nt on PerC.UniqueId = Nt.DonorId where PerC.IsDeleted != 1 and Com3.Q < SysSet.MaxYearCytapheresisCount and cast(PerC.BirthDate as date) > cast(dateadd(year, -SysSet.DonorMaxAge, getdate()) as date) and cast(PerC.BirthDate as date) < cast(dateadd(year, -SysSet.DonorMinAge, getdate()) as date) and PerC.BirthDateIsUndefined = 0 and PerC.DeathDate is null and PerC.UniqueId not in (select PrReg.DonorId from DonationProcessRegistry PrReg where PrReg.RegDate = cast(getdate() as date) and PrReg.CurrentState != 6) and PerC.UniqueId not in (select Don.DonorId from Donations Don where cast(Don.DonationDate as date) = cast(getdate() as date)) and PerC.UniqueId not in (select Def.DonorId from Deferrals Def join ref.DeferralTypes DefT on Def.DeferralTypeId = DefT.UniqueId where ((DefT.BaseType in (1, 2) and Def.RevokeDate is null) or (DefT.BaseType = 3 and (cast(Def.StopDate as date) >= cast(getdate() as date) or Def.StopDate is null)))) and PerC.UniqueId not in (select MaxDon.DonorId from Donations Don join (select Don.DonorId, max(Don.DonationDate) MaxDate from Donations Don, ref.SystemSettings SysSet where Don.OrgId = SysSet.CurrentOrganizationId group by Don.DonorId) MaxDon on Don.DonorId = MaxDon.DonorId and Don.DonationDate != MaxDon.MaxDate join DonationTestResults DonTest on Don.UniqueId = DonTest.DonationId where DonTest.TestTypeId = 42 and DonTest.TestValue = 13) and PerC.Gender in (1,2) and PerC.IdentityDocId is not null and ((PerC.RegAddressId is not null and (PerC.RegAddressIsInactive = 0 or PerC.RegAddressIsInactive is null)) or (PerC.FactAddressId is not null and (PerC.FactAddressIsInactive = 0 or PerC.FactAddressIsInactive is null)) or (PerC.TempAddressId is not null and (PerC.TempAddressIsInactive = 0 or PerC.TempAddressIsInactive is null))) and Epid1.Id is null and Epid2.Id is null and Epid3.Id is null and DonTP.IsActive = 1 and DonT.DonationParams not in (4, 5, 6, 7, 12, 15) and (cast(AppD.NextDonationDate as date) <= cast(getdate() as date) or AppD.NextDonationDate is null) and (Nt.AssignedTo not in (1, 3, 5, 7, 17, 19, 21, 23) or (Nt.IsFixed != 1 and cast(Nt.CreateDate as date) != cast(getdate() as date)) or Nt.UniqueId is null) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType = 2) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType in (3, 4) and MedTT.BloodTestCategory != 10) and DonT.ChargeType not in (0, 3) and DonT.ComponentType in (3, 4, 5) and PerC.UniqueId not in (select Don.DonorId from Donations Don where Don.ResultStatus != 5)",20
"select top(1) PerC.UniqueId Ent from ref.SystemSettings SysSet, PersonCards PerC join AppointedDonationTypes AppD on PerC.UniqueId = AppD.DonorId join (select AppD.DonorId, max(AppD.DonationDate) MaxDate from AppointedDonationTypes AppD group by AppD.DonorId) Main on AppD.DonorId = Main.DonorId and AppD.DonationDate = Main.MaxDate join ref.DonationTypeParams DonTP on AppD.DonationTypeId = DonTP.DonationTypeId join ref.DonationTypes DonT on AppD.DonationTypeId = DonT.UniqueId left join EpidControls Epid1 on PerC.RegAddressId = Epid1.PersonAddressId left join EpidControls Epid2 on PerC.FactAddressId = Epid2.PersonAddressId left join EpidControls Epid3 on PerC.TempAddressId = Epid3.PersonAddressId left join (select Don.DonorId, count(Don.UniqueId) Q from Donations Don join ref.DonationTypes DonT on Don.DonationTypeId = DonT.UniqueId where DonT.ComponentType = 2 and Don.IsDeleted = 0 and Don.UniqueId not in (select DonCom.DonationId from DonationComplications DonCom join ref.DonationComplicationTypes DonComT on DonCom.ComplicationTypeGuid = DonComT.Guid where DonComT.CalculateDonation = 0) and cast(Don.DonationDate as date) > dateadd(year, -1, cast(getdate() as date)) group by Don.DonorId) Com2 on PerC.UniqueId = Com2.DonorId left join (select Don.DonorId, sum(Prod.Volume) Q from Donations Don join ref.DonationTypes DonT on Don.DonationTypeId = DonT.UniqueId join ProductComponents Prod on Don.UniqueId = Prod.DonationId where DonT.ComponentType = 2 and Don.IsDeleted = 0 and Don.UniqueId not in (select DonCom.DonationId from DonationComplications DonCom join ref.DonationComplicationTypes DonComT on DonCom.ComplicationTypeGuid = DonComT.Guid where DonComT.CalculateDonation = 0) and cast(Don.DonationDate as date) > dateadd(year, -1, cast(getdate() as date)) group by Don.DonorId) Com4 on PerC.UniqueId = Com4.DonorId left join PersonMedicalNotes Nt on PerC.UniqueId = Nt.DonorId where PerC.IsDeleted != 1 and (Com2.Q = SysSet.MaxYearPlasmapheresisCount or Com2.Q is null) and Com4.Q + DonTP.StdDose < SysSet.MaxYearPlasmaVolumeMale * 1000 and cast(PerC.BirthDate as date) > cast(dateadd(year, -SysSet.DonorMaxAge, getdate()) as date) and cast(PerC.BirthDate as date) < cast(dateadd(year, -SysSet.DonorMinAge, getdate()) as date) and PerC.BirthDateIsUndefined = 0 and PerC.DeathDate is null and PerC.UniqueId not in (select PrReg.DonorId from DonationProcessRegistry PrReg where PrReg.RegDate = cast(getdate() as date) and PrReg.CurrentState != 6) and PerC.UniqueId not in (select Don.DonorId from Donations Don where cast(Don.DonationDate as date) = cast(getdate() as date)) and PerC.UniqueId not in (select Def.DonorId from Deferrals Def join ref.DeferralTypes DefT on Def.DeferralTypeId = DefT.UniqueId where ((DefT.BaseType in (1, 2) and Def.RevokeDate is null) or (DefT.BaseType = 3 and (cast(Def.StopDate as date) >= cast(getdate() as date) or Def.StopDate is null)))) and PerC.UniqueId not in (select MaxDon.DonorId from Donations Don join (select Don.DonorId, max(Don.DonationDate) MaxDate from Donations Don, ref.SystemSettings SysSet where Don.OrgId = SysSet.CurrentOrganizationId group by Don.DonorId) MaxDon on Don.DonorId = MaxDon.DonorId and Don.DonationDate != MaxDon.MaxDate join DonationTestResults DonTest on Don.UniqueId = DonTest.DonationId where DonTest.TestTypeId = 42 and DonTest.TestValue = 13) and PerC.Gender = 1 and PerC.IdentityDocId is not null and ((PerC.RegAddressId is not null and (PerC.RegAddressIsInactive = 0 or PerC.RegAddressIsInactive is null)) or (PerC.FactAddressId is not null and (PerC.FactAddressIsInactive = 0 or PerC.FactAddressIsInactive is null)) or (PerC.TempAddressId is not null and (PerC.TempAddressIsInactive = 0 or PerC.TempAddressIsInactive is null))) and Epid1.Id is null and Epid2.Id is null and Epid3.Id is null and DonTP.IsActive = 1 and DonT.DonationParams not in (4, 5, 6, 7, 12, 15) and (cast(AppD.NextDonationDate as date) <= cast(getdate() as date) or AppD.NextDonationDate is null) and (Nt.AssignedTo not in (1, 3, 5, 7, 17, 19, 21, 23) or (Nt.IsFixed != 1 and cast(Nt.CreateDate as date) != cast(getdate() as date)) or Nt.UniqueId is null) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType = 2) and DonT.UniqueId in (select DonTest.DonationTypeId from ref.DonationTypeBloodTestTypes DonTest join ref.MedicalTestTypes MedTT on DonTest.BloodTestTypeId = MedTT.Id and MedTT.ExamType in (3, 4) and MedTT.BloodTestCategory != 10) and DonT.ChargeType not in (0, 3) and DonT.ComponentType = 2 and PerC.UniqueId not in (select Don.DonorId from Donations Don where Don.ResultStatus != 5)",21